/*!
 * w-orm-level v1.0.0
 * (c) 2018-2021 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("events")):"function"==typeof define&&define.amd?define(["events"],e):(t="undefined"!=typeof globalThis?globalThis:t||self)["w-orm-level"]=e(t.events)}(this,(function(t){"use strict";function e(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function n(t,e){if(null==t)return{};var n,r,o=function(t,e){if(null==t)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(-1!==e.indexOf(r))continue;n[r]=t[r]}return n}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],-1===e.indexOf(n)&&{}.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}var r={},o={};function i(t){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i(t)}function s(t){var e=function(t,e){if("object"!=i(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=i(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==i(e)?e:e+""}function c(t,e,n){return(e=s(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var a,u={},l={supports:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=e.reduce(((t,e)=>Object.assign(t,e)),{}),o=r.implicitSnapshots||r.snapshots||!1,i=r.explicitSnapshots||!1;return Object.assign(r,{implicitSnapshots:o,explicitSnapshots:i,snapshots:o,has:r.has||!1,permanence:r.permanence||!1,seek:r.seek||!1,createIfMissing:r.createIfMissing||!1,errorIfExists:r.errorIfExists||!1,deferredOpen:r.deferredOpen||!1,streams:r.streams||!1,encodings:Object.assign({},r.encodings),events:Object.assign({},r.events),additionalMethods:Object.assign({},r.additionalMethods),signals:Object.assign({},r.signals)})}},f={},h=class extends Error{constructor(t,e){super(t||""),"object"==typeof e&&null!==e&&(e.code&&(this.code=String(e.code)),e.expected&&(this.expected=!0),e.transient&&(this.transient=!0),e.cause&&(this.cause=e.cause)),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}},p={},d={},y={};var g,b,v={};
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function w(){return g||(g=1,v.read=function(t,e,n,r,o){var i,s,c=8*o-r-1,a=(1<<c)-1,u=a>>1,l=-7,f=n?o-1:0,h=n?-1:1,p=t[e+f];for(f+=h,i=p&(1<<-l)-1,p>>=-l,l+=c;l>0;i=256*i+t[e+f],f+=h,l-=8);for(s=i&(1<<-l)-1,i>>=-l,l+=r;l>0;s=256*s+t[e+f],f+=h,l-=8);if(0===i)i=1-u;else{if(i===a)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),i-=u}return(p?-1:1)*s*Math.pow(2,i-r)},v.write=function(t,e,n,r,o,i){var s,c,a,u=8*i-o-1,l=(1<<u)-1,f=l>>1,h=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:i-1,d=r?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(c=isNaN(e)?1:0,s=l):(s=Math.floor(Math.log(e)/Math.LN2),e*(a=Math.pow(2,-s))<1&&(s--,a*=2),(e+=s+f>=1?h/a:h*Math.pow(2,1-f))*a>=2&&(s++,a/=2),s+f>=l?(c=0,s=l):s+f>=1?(c=(e*a-1)*Math.pow(2,o),s+=f):(c=e*Math.pow(2,f-1)*Math.pow(2,o),s=0));o>=8;t[n+p]=255&c,p+=d,c/=256,o-=8);for(s=s<<o|c,u+=o;u>0;t[n+p]=255&s,p+=d,s/=256,u-=8);t[n+p-d]|=128*y}),v}
/*!
	 * The buffer module from node.js, for the browser.
	 *
	 * @author   Feross Aboukhadijeh <https://feross.org>
	 * @license  MIT
	 */function m(){return b||(b=1,function(t){const e=function(){if(a)return y;a=1,y.byteLength=function(t){var e=i(t),n=e[0],r=e[1];return 3*(n+r)/4-r},y.toByteArray=function(t){var r,o,s=i(t),c=s[0],a=s[1],u=new n(function(t,e,n){return 3*(e+n)/4-n}(0,c,a)),l=0,f=a>0?c-4:c;for(o=0;o<f;o+=4)r=e[t.charCodeAt(o)]<<18|e[t.charCodeAt(o+1)]<<12|e[t.charCodeAt(o+2)]<<6|e[t.charCodeAt(o+3)],u[l++]=r>>16&255,u[l++]=r>>8&255,u[l++]=255&r;return 2===a&&(r=e[t.charCodeAt(o)]<<2|e[t.charCodeAt(o+1)]>>4,u[l++]=255&r),1===a&&(r=e[t.charCodeAt(o)]<<10|e[t.charCodeAt(o+1)]<<4|e[t.charCodeAt(o+2)]>>2,u[l++]=r>>8&255,u[l++]=255&r),u},y.fromByteArray=function(e){for(var n,r=e.length,o=r%3,i=[],c=16383,a=0,u=r-o;a<u;a+=c)i.push(s(e,a,a+c>u?u:a+c));return 1===o?(n=e[r-1],i.push(t[n>>2]+t[n<<4&63]+"==")):2===o&&(n=(e[r-2]<<8)+e[r-1],i.push(t[n>>10]+t[n>>4&63]+t[n<<2&63]+"=")),i.join("")};for(var t=[],e=[],n="undefined"!=typeof Uint8Array?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0;o<64;++o)t[o]=r[o],e[r.charCodeAt(o)]=o;function i(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");return-1===n&&(n=e),[n,n===e?0:4-n%4]}function s(e,n,r){for(var o,i,s=[],c=n;c<r;c+=3)o=(e[c]<<16&16711680)+(e[c+1]<<8&65280)+(255&e[c+2]),s.push(t[(i=o)>>18&63]+t[i>>12&63]+t[i>>6&63]+t[63&i]);return s.join("")}return e["-".charCodeAt(0)]=62,e["_".charCodeAt(0)]=63,y}(),n=w(),r="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=s,t.SlowBuffer=function(t){+t!=t&&(t=0);return s.alloc(+t)},t.INSPECT_MAX_BYTES=50;const o=2147483647;function i(t){if(t>o)throw new RangeError('The value "'+t+'" is invalid for option "size"');const e=new Uint8Array(t);return Object.setPrototypeOf(e,s.prototype),e}function s(t,e,n){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return l(t)}return c(t,e,n)}function c(t,e,n){if("string"==typeof t)return function(t,e){"string"==typeof e&&""!==e||(e="utf8");if(!s.isEncoding(e))throw new TypeError("Unknown encoding: "+e);const n=0|d(t,e);let r=i(n);const o=r.write(t,e);o!==n&&(r=r.slice(0,o));return r}(t,e);if(ArrayBuffer.isView(t))return function(t){if(J(t,Uint8Array)){const e=new Uint8Array(t);return h(e.buffer,e.byteOffset,e.byteLength)}return f(t)}(t);if(null==t)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(J(t,ArrayBuffer)||t&&J(t.buffer,ArrayBuffer))return h(t,e,n);if("undefined"!=typeof SharedArrayBuffer&&(J(t,SharedArrayBuffer)||t&&J(t.buffer,SharedArrayBuffer)))return h(t,e,n);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');const r=t.valueOf&&t.valueOf();if(null!=r&&r!==t)return s.from(r,e,n);const o=function(t){if(s.isBuffer(t)){const e=0|p(t.length),n=i(e);return 0===n.length||t.copy(n,0,0,e),n}if(void 0!==t.length)return"number"!=typeof t.length||Q(t.length)?i(0):f(t);if("Buffer"===t.type&&Array.isArray(t.data))return f(t.data)}(t);if(o)return o;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return s.from(t[Symbol.toPrimitive]("string"),e,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function u(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function l(t){return u(t),i(t<0?0:0|p(t))}function f(t){const e=t.length<0?0:0|p(t.length),n=i(e);for(let r=0;r<e;r+=1)n[r]=255&t[r];return n}function h(t,e,n){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(n||0))throw new RangeError('"length" is outside of buffer bounds');let r;return r=void 0===e&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,e):new Uint8Array(t,e,n),Object.setPrototypeOf(r,s.prototype),r}function p(t){if(t>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|t}function d(t,e){if(s.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||J(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);const n=t.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;let o=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return W(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return Y(t).length;default:if(o)return r?-1:W(t).length;e=(""+e).toLowerCase(),o=!0}}function g(t,e,n){let r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return I(this,e,n);case"utf8":case"utf-8":return x(this,e,n);case"ascii":return S(this,e,n);case"latin1":case"binary":return T(this,e,n);case"base64":return A(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function b(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function v(t,e,n,r,o){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),Q(n=+n)&&(n=o?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(o)return-1;n=t.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof e&&(e=s.from(e,r)),s.isBuffer(e))return 0===e.length?-1:m(t,e,n,r,o);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):m(t,[e],n,r,o);throw new TypeError("val must be string, number or Buffer")}function m(t,e,n,r,o){let i,s=1,c=t.length,a=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;s=2,c/=2,a/=2,n/=2}function u(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(o){let r=-1;for(i=n;i<c;i++)if(u(t,i)===u(e,-1===r?0:i-r)){if(-1===r&&(r=i),i-r+1===a)return r*s}else-1!==r&&(i-=i-r),r=-1}else for(n+a>c&&(n=c-a),i=n;i>=0;i--){let n=!0;for(let r=0;r<a;r++)if(u(t,i+r)!==u(e,r)){n=!1;break}if(n)return i}return-1}function O(t,e,n,r){n=Number(n)||0;const o=t.length-n;r?(r=Number(r))>o&&(r=o):r=o;const i=e.length;let s;for(r>i/2&&(r=i/2),s=0;s<r;++s){const r=parseInt(e.substr(2*s,2),16);if(Q(r))return s;t[n+s]=r}return s}function E(t,e,n,r){return H(W(e,t.length-n),t,n,r)}function j(t,e,n,r){return H(function(t){const e=[];for(let n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function _(t,e,n,r){return H(Y(e),t,n,r)}function k(t,e,n,r){return H(function(t,e){let n,r,o;const i=[];for(let s=0;s<t.length&&!((e-=2)<0);++s)n=t.charCodeAt(s),r=n>>8,o=n%256,i.push(o),i.push(r);return i}(e,t.length-n),t,n,r)}function A(t,n,r){return 0===n&&r===t.length?e.fromByteArray(t):e.fromByteArray(t.slice(n,r))}function x(t,e,n){n=Math.min(t.length,n);const r=[];let o=e;for(;o<n;){const e=t[o];let i=null,s=e>239?4:e>223?3:e>191?2:1;if(o+s<=n){let n,r,c,a;switch(s){case 1:e<128&&(i=e);break;case 2:n=t[o+1],128==(192&n)&&(a=(31&e)<<6|63&n,a>127&&(i=a));break;case 3:n=t[o+1],r=t[o+2],128==(192&n)&&128==(192&r)&&(a=(15&e)<<12|(63&n)<<6|63&r,a>2047&&(a<55296||a>57343)&&(i=a));break;case 4:n=t[o+1],r=t[o+2],c=t[o+3],128==(192&n)&&128==(192&r)&&128==(192&c)&&(a=(15&e)<<18|(63&n)<<12|(63&r)<<6|63&c,a>65535&&a<1114112&&(i=a))}}null===i?(i=65533,s=1):i>65535&&(i-=65536,r.push(i>>>10&1023|55296),i=56320|1023&i),r.push(i),o+=s}return function(t){const e=t.length;if(e<=P)return String.fromCharCode.apply(String,t);let n="",r=0;for(;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=P));return n}(r)}t.kMaxLength=o,s.TYPED_ARRAY_SUPPORT=function(){try{const t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}(),s.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}}),s.poolSize=8192,s.from=function(t,e,n){return c(t,e,n)},Object.setPrototypeOf(s.prototype,Uint8Array.prototype),Object.setPrototypeOf(s,Uint8Array),s.alloc=function(t,e,n){return function(t,e,n){return u(t),t<=0?i(t):void 0!==e?"string"==typeof n?i(t).fill(e,n):i(t).fill(e):i(t)}(t,e,n)},s.allocUnsafe=function(t){return l(t)},s.allocUnsafeSlow=function(t){return l(t)},s.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==s.prototype},s.compare=function(t,e){if(J(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),J(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),!s.isBuffer(t)||!s.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;let n=t.length,r=e.length;for(let o=0,i=Math.min(n,r);o<i;++o)if(t[o]!==e[o]){n=t[o],r=e[o];break}return n<r?-1:r<n?1:0},s.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return s.alloc(0);let n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;const r=s.allocUnsafe(e);let o=0;for(n=0;n<t.length;++n){let e=t[n];if(J(e,Uint8Array))o+e.length>r.length?(s.isBuffer(e)||(e=s.from(e)),e.copy(r,o)):Uint8Array.prototype.set.call(r,e,o);else{if(!s.isBuffer(e))throw new TypeError('"list" argument must be an Array of Buffers');e.copy(r,o)}o+=e.length}return r},s.byteLength=d,s.prototype._isBuffer=!0,s.prototype.swap16=function(){const t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let e=0;e<t;e+=2)b(this,e,e+1);return this},s.prototype.swap32=function(){const t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let e=0;e<t;e+=4)b(this,e,e+3),b(this,e+1,e+2);return this},s.prototype.swap64=function(){const t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let e=0;e<t;e+=8)b(this,e,e+7),b(this,e+1,e+6),b(this,e+2,e+5),b(this,e+3,e+4);return this},s.prototype.toString=function(){const t=this.length;return 0===t?"":0===arguments.length?x(this,0,t):g.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(t){if(!s.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===s.compare(this,t)},s.prototype.inspect=function(){let e="";const n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},r&&(s.prototype[r]=s.prototype.inspect),s.prototype.compare=function(t,e,n,r,o){if(J(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),!s.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===o&&(o=this.length),e<0||n>t.length||r<0||o>this.length)throw new RangeError("out of range index");if(r>=o&&e>=n)return 0;if(r>=o)return-1;if(e>=n)return 1;if(this===t)return 0;let i=(o>>>=0)-(r>>>=0),c=(n>>>=0)-(e>>>=0);const a=Math.min(i,c),u=this.slice(r,o),l=t.slice(e,n);for(let t=0;t<a;++t)if(u[t]!==l[t]){i=u[t],c=l[t];break}return i<c?-1:c<i?1:0},s.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},s.prototype.indexOf=function(t,e,n){return v(this,t,e,n,!0)},s.prototype.lastIndexOf=function(t,e,n){return v(this,t,e,n,!1)},s.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}const o=this.length-e;if((void 0===n||n>o)&&(n=o),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let i=!1;for(;;)switch(r){case"hex":return O(this,t,e,n);case"utf8":case"utf-8":return E(this,t,e,n);case"ascii":case"latin1":case"binary":return j(this,t,e,n);case"base64":return _(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,t,e,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const P=4096;function S(t,e,n){let r="";n=Math.min(t.length,n);for(let o=e;o<n;++o)r+=String.fromCharCode(127&t[o]);return r}function T(t,e,n){let r="";n=Math.min(t.length,n);for(let o=e;o<n;++o)r+=String.fromCharCode(t[o]);return r}function I(t,e,n){const r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);let o="";for(let r=e;r<n;++r)o+=X[t[r]];return o}function B(t,e,n){const r=t.slice(e,n);let o="";for(let t=0;t<r.length-1;t+=2)o+=String.fromCharCode(r[t]+256*r[t+1]);return o}function $(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function D(t,e,n,r,o,i){if(!s.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>o||e<i)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function L(t,e,n,r,o){K(e,r,o,t,n,7);let i=Number(e&BigInt(4294967295));t[n++]=i,i>>=8,t[n++]=i,i>>=8,t[n++]=i,i>>=8,t[n++]=i;let s=Number(e>>BigInt(32)&BigInt(4294967295));return t[n++]=s,s>>=8,t[n++]=s,s>>=8,t[n++]=s,s>>=8,t[n++]=s,n}function R(t,e,n,r,o){K(e,r,o,t,n,7);let i=Number(e&BigInt(4294967295));t[n+7]=i,i>>=8,t[n+6]=i,i>>=8,t[n+5]=i,i>>=8,t[n+4]=i;let s=Number(e>>BigInt(32)&BigInt(4294967295));return t[n+3]=s,s>>=8,t[n+2]=s,s>>=8,t[n+1]=s,s>>=8,t[n]=s,n+8}function M(t,e,n,r,o,i){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function C(t,e,r,o,i){return e=+e,r>>>=0,i||M(t,0,r,4),n.write(t,e,r,o,23,4),r+4}function U(t,e,r,o,i){return e=+e,r>>>=0,i||M(t,0,r,8),n.write(t,e,r,o,52,8),r+8}s.prototype.slice=function(t,e){const n=this.length;(t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(e=void 0===e?n:~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t);const r=this.subarray(t,e);return Object.setPrototypeOf(r,s.prototype),r},s.prototype.readUintLE=s.prototype.readUIntLE=function(t,e,n){t>>>=0,e>>>=0,n||$(t,e,this.length);let r=this[t],o=1,i=0;for(;++i<e&&(o*=256);)r+=this[t+i]*o;return r},s.prototype.readUintBE=s.prototype.readUIntBE=function(t,e,n){t>>>=0,e>>>=0,n||$(t,e,this.length);let r=this[t+--e],o=1;for(;e>0&&(o*=256);)r+=this[t+--e]*o;return r},s.prototype.readUint8=s.prototype.readUInt8=function(t,e){return t>>>=0,e||$(t,1,this.length),this[t]},s.prototype.readUint16LE=s.prototype.readUInt16LE=function(t,e){return t>>>=0,e||$(t,2,this.length),this[t]|this[t+1]<<8},s.prototype.readUint16BE=s.prototype.readUInt16BE=function(t,e){return t>>>=0,e||$(t,2,this.length),this[t]<<8|this[t+1]},s.prototype.readUint32LE=s.prototype.readUInt32LE=function(t,e){return t>>>=0,e||$(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},s.prototype.readUint32BE=s.prototype.readUInt32BE=function(t,e){return t>>>=0,e||$(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},s.prototype.readBigUInt64LE=Z((function(t){z(t>>>=0,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||q(t,this.length-8);const r=e+256*this[++t]+65536*this[++t]+this[++t]*2**24,o=this[++t]+256*this[++t]+65536*this[++t]+n*2**24;return BigInt(r)+(BigInt(o)<<BigInt(32))})),s.prototype.readBigUInt64BE=Z((function(t){z(t>>>=0,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||q(t,this.length-8);const r=e*2**24+65536*this[++t]+256*this[++t]+this[++t],o=this[++t]*2**24+65536*this[++t]+256*this[++t]+n;return(BigInt(r)<<BigInt(32))+BigInt(o)})),s.prototype.readIntLE=function(t,e,n){t>>>=0,e>>>=0,n||$(t,e,this.length);let r=this[t],o=1,i=0;for(;++i<e&&(o*=256);)r+=this[t+i]*o;return o*=128,r>=o&&(r-=Math.pow(2,8*e)),r},s.prototype.readIntBE=function(t,e,n){t>>>=0,e>>>=0,n||$(t,e,this.length);let r=e,o=1,i=this[t+--r];for(;r>0&&(o*=256);)i+=this[t+--r]*o;return o*=128,i>=o&&(i-=Math.pow(2,8*e)),i},s.prototype.readInt8=function(t,e){return t>>>=0,e||$(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},s.prototype.readInt16LE=function(t,e){t>>>=0,e||$(t,2,this.length);const n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt16BE=function(t,e){t>>>=0,e||$(t,2,this.length);const n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},s.prototype.readInt32LE=function(t,e){return t>>>=0,e||$(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},s.prototype.readInt32BE=function(t,e){return t>>>=0,e||$(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},s.prototype.readBigInt64LE=Z((function(t){z(t>>>=0,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||q(t,this.length-8);const r=this[t+4]+256*this[t+5]+65536*this[t+6]+(n<<24);return(BigInt(r)<<BigInt(32))+BigInt(e+256*this[++t]+65536*this[++t]+this[++t]*2**24)})),s.prototype.readBigInt64BE=Z((function(t){z(t>>>=0,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||q(t,this.length-8);const r=(e<<24)+65536*this[++t]+256*this[++t]+this[++t];return(BigInt(r)<<BigInt(32))+BigInt(this[++t]*2**24+65536*this[++t]+256*this[++t]+n)})),s.prototype.readFloatLE=function(t,e){return t>>>=0,e||$(t,4,this.length),n.read(this,t,!0,23,4)},s.prototype.readFloatBE=function(t,e){return t>>>=0,e||$(t,4,this.length),n.read(this,t,!1,23,4)},s.prototype.readDoubleLE=function(t,e){return t>>>=0,e||$(t,8,this.length),n.read(this,t,!0,52,8)},s.prototype.readDoubleBE=function(t,e){return t>>>=0,e||$(t,8,this.length),n.read(this,t,!1,52,8)},s.prototype.writeUintLE=s.prototype.writeUIntLE=function(t,e,n,r){if(t=+t,e>>>=0,n>>>=0,!r){D(this,t,e,n,Math.pow(2,8*n)-1,0)}let o=1,i=0;for(this[e]=255&t;++i<n&&(o*=256);)this[e+i]=t/o&255;return e+n},s.prototype.writeUintBE=s.prototype.writeUIntBE=function(t,e,n,r){if(t=+t,e>>>=0,n>>>=0,!r){D(this,t,e,n,Math.pow(2,8*n)-1,0)}let o=n-1,i=1;for(this[e+o]=255&t;--o>=0&&(i*=256);)this[e+o]=t/i&255;return e+n},s.prototype.writeUint8=s.prototype.writeUInt8=function(t,e,n){return t=+t,e>>>=0,n||D(this,t,e,1,255,0),this[e]=255&t,e+1},s.prototype.writeUint16LE=s.prototype.writeUInt16LE=function(t,e,n){return t=+t,e>>>=0,n||D(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},s.prototype.writeUint16BE=s.prototype.writeUInt16BE=function(t,e,n){return t=+t,e>>>=0,n||D(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},s.prototype.writeUint32LE=s.prototype.writeUInt32LE=function(t,e,n){return t=+t,e>>>=0,n||D(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},s.prototype.writeUint32BE=s.prototype.writeUInt32BE=function(t,e,n){return t=+t,e>>>=0,n||D(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},s.prototype.writeBigUInt64LE=Z((function(t){return L(this,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,BigInt(0),BigInt("0xffffffffffffffff"))})),s.prototype.writeBigUInt64BE=Z((function(t){return R(this,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,BigInt(0),BigInt("0xffffffffffffffff"))})),s.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e>>>=0,!r){const r=Math.pow(2,8*n-1);D(this,t,e,n,r-1,-r)}let o=0,i=1,s=0;for(this[e]=255&t;++o<n&&(i*=256);)t<0&&0===s&&0!==this[e+o-1]&&(s=1),this[e+o]=(t/i|0)-s&255;return e+n},s.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e>>>=0,!r){const r=Math.pow(2,8*n-1);D(this,t,e,n,r-1,-r)}let o=n-1,i=1,s=0;for(this[e+o]=255&t;--o>=0&&(i*=256);)t<0&&0===s&&0!==this[e+o+1]&&(s=1),this[e+o]=(t/i|0)-s&255;return e+n},s.prototype.writeInt8=function(t,e,n){return t=+t,e>>>=0,n||D(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},s.prototype.writeInt16LE=function(t,e,n){return t=+t,e>>>=0,n||D(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},s.prototype.writeInt16BE=function(t,e,n){return t=+t,e>>>=0,n||D(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},s.prototype.writeInt32LE=function(t,e,n){return t=+t,e>>>=0,n||D(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},s.prototype.writeInt32BE=function(t,e,n){return t=+t,e>>>=0,n||D(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},s.prototype.writeBigInt64LE=Z((function(t){return L(this,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),s.prototype.writeBigInt64BE=Z((function(t){return R(this,t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),s.prototype.writeFloatLE=function(t,e,n){return C(this,t,e,!0,n)},s.prototype.writeFloatBE=function(t,e,n){return C(this,t,e,!1,n)},s.prototype.writeDoubleLE=function(t,e,n){return U(this,t,e,!0,n)},s.prototype.writeDoubleBE=function(t,e,n){return U(this,t,e,!1,n)},s.prototype.copy=function(t,e,n,r){if(!s.isBuffer(t))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);const o=r-n;return this===t&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(e,n,r):Uint8Array.prototype.set.call(t,this.subarray(n,r),e),o},s.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!s.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===t.length){const e=t.charCodeAt(0);("utf8"===r&&e<128||"latin1"===r)&&(t=e)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;let o;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(o=e;o<n;++o)this[o]=t;else{const i=s.isBuffer(t)?t:s.from(t,r),c=i.length;if(0===c)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(o=0;o<n-e;++o)this[o+e]=i[o%c]}return this};const N={};function V(t,e,n){N[t]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${t}]`,this.stack,delete this.name}get code(){return t}set code(t){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:t,writable:!0})}toString(){return`${this.name} [${t}]: ${this.message}`}}}function F(t){let e="",n=t.length;const r="-"===t[0]?1:0;for(;n>=r+4;n-=3)e=`_${t.slice(n-3,n)}${e}`;return`${t.slice(0,n)}${e}`}function K(t,e,n,r,o,i){if(t>n||t<e){const r="bigint"==typeof e?"n":"";let o;throw o=i>3?0===e||e===BigInt(0)?`>= 0${r} and < 2${r} ** ${8*(i+1)}${r}`:`>= -(2${r} ** ${8*(i+1)-1}${r}) and < 2 ** ${8*(i+1)-1}${r}`:`>= ${e}${r} and <= ${n}${r}`,new N.ERR_OUT_OF_RANGE("value",o,t)}!function(t,e,n){z(e,"offset"),void 0!==t[e]&&void 0!==t[e+n]||q(e,t.length-(n+1))}(r,o,i)}function z(t,e){if("number"!=typeof t)throw new N.ERR_INVALID_ARG_TYPE(e,"number",t)}function q(t,e,n){if(Math.floor(t)!==t)throw z(t,n),new N.ERR_OUT_OF_RANGE(n||"offset","an integer",t);if(e<0)throw new N.ERR_BUFFER_OUT_OF_BOUNDS;throw new N.ERR_OUT_OF_RANGE(n||"offset",`>= ${n?1:0} and <= ${e}`,t)}V("ERR_BUFFER_OUT_OF_BOUNDS",(function(t){return t?`${t} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),V("ERR_INVALID_ARG_TYPE",(function(t,e){return`The "${t}" argument must be of type number. Received type ${typeof e}`}),TypeError),V("ERR_OUT_OF_RANGE",(function(t,e,n){let r=`The value of "${t}" is out of range.`,o=n;return Number.isInteger(n)&&Math.abs(n)>2**32?o=F(String(n)):"bigint"==typeof n&&(o=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(o=F(o)),o+="n"),r+=` It must be ${e}. Received ${o}`,r}),RangeError);const G=/[^+/0-9A-Za-z-_]/g;function W(t,e){let n;e=e||1/0;const r=t.length;let o=null;const i=[];for(let s=0;s<r;++s){if(n=t.charCodeAt(s),n>55295&&n<57344){if(!o){if(n>56319){(e-=3)>-1&&i.push(239,191,189);continue}if(s+1===r){(e-=3)>-1&&i.push(239,191,189);continue}o=n;continue}if(n<56320){(e-=3)>-1&&i.push(239,191,189),o=n;continue}n=65536+(o-55296<<10|n-56320)}else o&&(e-=3)>-1&&i.push(239,191,189);if(o=null,n<128){if((e-=1)<0)break;i.push(n)}else if(n<2048){if((e-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function Y(t){return e.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(G,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function H(t,e,n,r){let o;for(o=0;o<r&&!(o+n>=e.length||o>=t.length);++o)e[o+n]=t[o];return o}function J(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function Q(t){return t!=t}const X=function(){const t="0123456789abcdef",e=new Array(256);for(let n=0;n<16;++n){const r=16*n;for(let o=0;o<16;++o)e[r+o]=t[n]+t[o]}return e}();function Z(t){return"undefined"==typeof BigInt?tt:t}function tt(){throw new Error("BigInt not supported")}}(d)),d}let O=null;var E=function(){return null===O&&(O={textEncoder:new TextEncoder,textDecoder:new TextDecoder}),O},j={},_={};const k=h,A=new Set(["buffer","view","utf8"]);function x(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function P(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?x(Object(n),!0).forEach((function(e){c(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}_.Encoding=class{constructor(t){if(this.encode=t.encode||this.encode,this.decode=t.decode||this.decode,this.name=t.name||this.name,this.format=t.format||this.format,"function"!=typeof this.encode)throw new TypeError("The 'encode' property must be a function");if("function"!=typeof this.decode)throw new TypeError("The 'decode' property must be a function");if(this.encode=this.encode.bind(this),this.decode=this.decode.bind(this),"string"!=typeof this.name||""===this.name)throw new TypeError("The 'name' property must be a string");if("string"!=typeof this.format||!A.has(this.format))throw new TypeError("The 'format' property must be one of 'buffer', 'view', 'utf8'");t.createViewTranscoder&&(this.createViewTranscoder=t.createViewTranscoder),t.createBufferTranscoder&&(this.createBufferTranscoder=t.createBufferTranscoder),t.createUTF8Transcoder&&(this.createUTF8Transcoder=t.createUTF8Transcoder)}get commonName(){return this.name.split("+")[0]}createBufferTranscoder(){throw new k(`Encoding '${this.name}' cannot be transcoded to 'buffer'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createViewTranscoder(){throw new k(`Encoding '${this.name}' cannot be transcoded to 'view'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createUTF8Transcoder(){throw new k(`Encoding '${this.name}' cannot be transcoded to 'utf8'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}};const{Buffer:S}=m()||{},{Encoding:T}=_,I=E;let B=class extends T{constructor(t){super(P(P({},t),{},{format:"buffer"}))}createViewTranscoder(){return new $({encode:this.encode,decode:t=>this.decode(S.from(t.buffer,t.byteOffset,t.byteLength)),name:`${this.name}+view`})}createBufferTranscoder(){return this}},$=class extends T{constructor(t){super(P(P({},t),{},{format:"view"}))}createBufferTranscoder(){return new B({encode:t=>{const e=this.encode(t);return S.from(e.buffer,e.byteOffset,e.byteLength)},decode:this.decode,name:`${this.name}+buffer`})}createViewTranscoder(){return this}};j.BufferFormat=B,j.ViewFormat=$,j.UTF8Format=class extends T{constructor(t){super(P(P({},t),{},{format:"utf8"}))}createBufferTranscoder(){return new B({encode:t=>S.from(this.encode(t),"utf8"),decode:t=>this.decode(t.toString("utf8")),name:`${this.name}+buffer`})}createViewTranscoder(){const{textEncoder:t,textDecoder:e}=I();return new $({encode:e=>t.encode(this.encode(e)),decode:t=>this.decode(e.decode(t)),name:`${this.name}+view`})}createUTF8Transcoder(){return this}};const{Buffer:D}=m()||{Buffer:{isBuffer:()=>!1}},{textEncoder:L,textDecoder:R}=E(),{BufferFormat:M,ViewFormat:C,UTF8Format:U}=j,N=t=>t;function V(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function F(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?V(Object(n),!0).forEach((function(e){c(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):V(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}p.utf8=new U({encode:function(t){return D.isBuffer(t)?t.toString("utf8"):ArrayBuffer.isView(t)?R.decode(t):String(t)},decode:N,name:"utf8",createViewTranscoder(){return new C({encode:function(t){return ArrayBuffer.isView(t)?t:L.encode(t)},decode:function(t){return R.decode(t)},name:`${this.name}+view`})},createBufferTranscoder(){return new M({encode:function(t){return D.isBuffer(t)?t:ArrayBuffer.isView(t)?D.from(t.buffer,t.byteOffset,t.byteLength):D.from(String(t),"utf8")},decode:function(t){return t.toString("utf8")},name:`${this.name}+buffer`})}}),p.json=new U({encode:JSON.stringify,decode:JSON.parse,name:"json"}),p.buffer=new M({encode:function(t){return D.isBuffer(t)?t:ArrayBuffer.isView(t)?D.from(t.buffer,t.byteOffset,t.byteLength):D.from(String(t),"utf8")},decode:N,name:"buffer",createViewTranscoder(){return new C({encode:function(t){return ArrayBuffer.isView(t)?t:D.from(String(t),"utf8")},decode:function(t){return D.from(t.buffer,t.byteOffset,t.byteLength)},name:`${this.name}+view`})}}),p.view=new C({encode:function(t){return ArrayBuffer.isView(t)?t:L.encode(t)},decode:N,name:"view",createBufferTranscoder(){return new M({encode:function(t){return D.isBuffer(t)?t:ArrayBuffer.isView(t)?D.from(t.buffer,t.byteOffset,t.byteLength):D.from(String(t),"utf8")},decode:N,name:`${this.name}+buffer`})}}),p.hex=new M({encode:function(t){return D.isBuffer(t)?t:D.from(String(t),"hex")},decode:function(t){return t.toString("hex")},name:"hex"}),p.base64=new M({encode:function(t){return D.isBuffer(t)?t:D.from(String(t),"base64")},decode:function(t){return t.toString("base64")},name:"base64"});const K=h,z=p,{Encoding:q}=_,{BufferFormat:G,ViewFormat:W,UTF8Format:Y}=j,H=Symbol("formats"),J=Symbol("encodings"),Q=new Set(["buffer","view","utf8"]);f.Transcoder=class{constructor(t){if(!Array.isArray(t))throw new TypeError("The first argument 'formats' must be an array");if(!t.every((t=>Q.has(t))))throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'");this[J]=new Map,this[H]=new Set(t);for(const t in z)try{this.encoding(t)}catch(t){if("LEVEL_ENCODING_NOT_SUPPORTED"!==t.code)throw t}}encodings(){return Array.from(new Set(this[J].values()))}encoding(t){let e=this[J].get(t);if(void 0===e){if("string"==typeof t&&""!==t){if(e=Z[t],!e)throw new K(`Encoding '${t}' is not found`,{code:"LEVEL_ENCODING_NOT_FOUND"})}else{if("object"!=typeof t||null===t)throw new TypeError("First argument 'encoding' must be a string or object");e=function(t){if(t instanceof q)return t;const e="type"in t&&"string"==typeof t.type?t.type:void 0,n=t.name||e||"anonymous-"+tt++;switch(function(t){return"format"in t&&void 0!==t.format?t.format:"buffer"in t&&"boolean"==typeof t.buffer?t.buffer?"buffer":"utf8":"code"in t&&Number.isInteger(t.code)?"view":"buffer"}(t)){case"view":return new W(F(F({},t),{},{name:n}));case"utf8":return new Y(F(F({},t),{},{name:n}));case"buffer":return new G(F(F({},t),{},{name:n}));default:throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}}(t)}const{name:n,format:r}=e;if(!this[H].has(r))if(this[H].has("view"))e=e.createViewTranscoder();else if(this[H].has("buffer"))e=e.createBufferTranscoder();else{if(!this[H].has("utf8"))throw new K(`Encoding '${n}' cannot be transcoded`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"});e=e.createUTF8Transcoder()}for(const r of[t,n,e.name,e.commonName])this[J].set(r,e)}return e}};const X={binary:z.buffer,"utf-8":z.utf8},Z=F(F({},z),X);let tt=0;const et=Symbol("kErrors");var nt=function(t){if(0!==(t=t.filter(st)).length)return 1===t.length?t[0]:new rt(t)};class rt extends Error{constructor(t){const e=new Set(t.map(ct).filter(Boolean));super(Array.from(e).join("; ")),ot(this,"name","CombinedError"),ot(this,et,t),it(this,"stack",(()=>t.map(at).join("\n\n"))),it(this,"transient",(()=>t.length>0&&t.every(ut))),it(this,"expected",(()=>t.length>0&&t.every(lt)))}[Symbol.iterator](){return this[et][Symbol.iterator]()}}function ot(t,e,n){Object.defineProperty(t,e,{value:n})}function it(t,e,n){Object.defineProperty(t,e,{get:n})}function st(t){return null!=t}function ct(t){return t.message}function at(t){return t.stack}function ut(t){return!0===t.transient}function lt(t){return!0===t.expected}var ft={},ht={};const pt=h,dt=new Set;ht.getOptions=function(t,e){return"object"==typeof t&&null!==t?t:void 0!==e?e:{}},ht.emptyOptions=Object.freeze({}),ht.noop=function(){},ht.resolvedPromise=Promise.resolve(),ht.deprecate=function(t){if(!dt.has(t)){dt.add(t);const e=globalThis.console;void 0!==e&&"function"==typeof e.warn&&e.warn(new pt(t,{code:"LEVEL_LEGACY"}))}};var yt={};const gt=h;function bt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function vt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?bt(Object(n),!0).forEach((function(e){c(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):bt(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}yt.AbortError=class extends gt{constructor(t){super("Operation has been aborted",{code:"LEVEL_ABORTED",cause:t})}get name(){return"AbortError"}};const wt=h,mt=nt,{getOptions:Ot,emptyOptions:Et,noop:jt}=ht,{AbortError:_t}=yt,kt=Symbol("decodeOne"),At=Symbol("decodeMany"),xt=Symbol("keyEncoding"),Pt=Symbol("valueEncoding");class St{#t=!1;#e=null;#n=null;#r=0;#o;#i;#s;#c;constructor(t,e){if("object"!=typeof t||null===t){throw new TypeError(`The first argument must be an abstract-level database, received ${null===t?"null":typeof t}`)}if("object"!=typeof e||null===e)throw new TypeError("The second argument must be an options object");this[xt]=e[xt],this[Pt]=e[Pt],this.#i=Number.isInteger(e.limit)&&e.limit>=0?e.limit:1/0,this.#o=null!=e.signal?e.signal:null,this.#c=null!=e.snapshot?e.snapshot:null,this.#s=!1,this.db=t,this.db.attachResource(this)}get count(){return this.#r}get limit(){return this.#i}async next(){this.#a();try{if(this.#s||this.#r>=this.#i)return void(this.#s=!0);let t=await this._next();if(void 0===t)return void(this.#s=!0);try{t=this[kt](t)}catch(t){throw new It(t)}return this.#r++,t}finally{this.#u()}}async _next(){}async nextv(t,e){if(!Number.isInteger(t))throw new TypeError("The first argument 'size' must be an integer");e=Ot(e,Et),t<1&&(t=1),this.#i<1/0&&(t=Math.min(t,this.#i-this.#r)),this.#a();try{if(this.#s||t<=0)return this.#s=!0,[];const n=await this._nextv(t,e);if(0===n.length)return this.#s=!0,n;try{this[At](n)}catch(t){throw new It(t)}return this.#r+=n.length,n}finally{this.#u()}}async _nextv(t,e){const n=[];for(;n.length<t;){const t=await this._next(e);if(void 0===t){this.#s=!0;break}n.push(t)}return n}async all(t){t=Ot(t,Et),this.#a();try{if(this.#s||this.#r>=this.#i)return[];const e=await this._all(t);try{this[At](e)}catch(t){throw new It(t)}return this.#r+=e.length,e}catch(t){this.#u(),await this.#l(t)}finally{this.#s=!0,this.#t&&(this.#u(),await this.close())}}async _all(t){let e=this.#r;const n=[];for(;;){const r=this.#i<1/0?Math.min(1e3,this.#i-e):1e3;if(r<=0)return n;const o=await this._nextv(r,t);if(0===o.length)return n;n.push.apply(n,o),e+=o.length}}seek(t,e){if(e=Ot(e,Et),null!==this.#n);else{if(this.#t)throw new wt("Iterator is busy: cannot call seek() until next() has completed",{code:"LEVEL_ITERATOR_BUSY"});{const n=this.db.keyEncoding(e.keyEncoding||this[xt]),r=n.format;e.keyEncoding!==r&&(e=vt(vt({},e),{},{keyEncoding:r}));const o=this.db.prefixKey(n.encode(t),r,!1);this._seek(o,e),this.#s=!1}}}_seek(t,e){throw new wt("Iterator does not implement seek()",{code:"LEVEL_NOT_SUPPORTED"})}async close(){return null!==this.#n?this.#n.catch(jt):(this.#n=new Promise(((t,e)=>{this.#e=()=>{this.#e=null,this.#f().then(t,e)}})),this.#t||this.#e(),this.#n)}async _close(){}async*[Symbol.asyncIterator](){try{let t;for(;void 0!==(t=await this.next());)yield t}catch(t){await this.#l(t)}finally{await this.close()}}#a(){var t,e;if(null!==this.#n)throw new wt("Iterator is not open: cannot read after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"});if(this.#t)throw new wt("Iterator is busy: cannot read until previous read has completed",{code:"LEVEL_ITERATOR_BUSY"});if(null!==(t=this.#o)&&void 0!==t&&t.aborted)throw new _t;null===(e=this.#c)||void 0===e||e.ref(),this.#t=!0}#u(){var t,e;this.#t=!1,null===(t=this.#e)||void 0===t||t.call(this),null===(e=this.#c)||void 0===e||e.unref()}async#f(){await this._close(),this.db.detachResource(this)}async#l(t){try{await this.close()}catch(e){throw mt([t,e])}throw t}}"symbol"==typeof Symbol.asyncDispose&&(St.prototype[Symbol.asyncDispose]=async function(){return this.close()});let Tt=class extends St{#h;#p;constructor(t,e){super(t,e),this.#h=!1!==e.keys,this.#p=!1!==e.values}[kt](t){const e=t[0],n=t[1];return void 0!==e&&(t[0]=this.#h?this[xt].decode(e):void 0),void 0!==n&&(t[1]=this.#p?this[Pt].decode(n):void 0),t}[At](t){const e=this[xt],n=this[Pt];for(const r of t){const t=r[0],o=r[1];void 0!==t&&(r[0]=this.#h?e.decode(t):void 0),void 0!==o&&(r[1]=this.#p?n.decode(o):void 0)}}};class It extends wt{constructor(t){super("Iterator could not decode data",{code:"LEVEL_DECODE_ERROR",cause:t})}}Tt.keyEncoding=xt,Tt.valueEncoding=Pt,ft.AbstractIterator=Tt,ft.AbstractKeyIterator=class extends St{[kt](t){return this[xt].decode(t)}[At](t){const e=this[xt];for(let n=0;n<t.length;n++){const r=t[n];void 0!==r&&(t[n]=e.decode(r))}}},ft.AbstractValueIterator=class extends St{[kt](t){return this[Pt].decode(t)}[At](t){const e=this[Pt];for(let n=0;n<t.length;n++){const r=t[n];void 0!==r&&(t[n]=e.decode(r))}}};var Bt={};function $t(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Dt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?$t(Object(n),!0).forEach((function(e){c(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$t(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}const{AbstractKeyIterator:Lt,AbstractValueIterator:Rt}=ft,Mt=Symbol("iterator"),Ct=Symbol("handleOne"),Ut=Symbol("handleMany");let Nt=class extends Lt{constructor(t,e){super(t,e),this[Mt]=t.iterator(Dt(Dt({},e),{},{keys:!0,values:!1}))}[Ct](t){return t[0]}[Ut](t){for(let e=0;e<t.length;e++)t[e]=t[e][0]}},Vt=class extends Rt{constructor(t,e){super(t,e),this[Mt]=t.iterator(Dt(Dt({},e),{},{keys:!1,values:!0}))}[Ct](t){return t[1]}[Ut](t){for(let e=0;e<t.length;e++)t[e]=t[e][1]}};for(const t of[Nt,Vt])t.prototype._next=async function(){const t=await this[Mt].next();return void 0===t?t:this[Ct](t)},t.prototype._nextv=async function(t,e){const n=await this[Mt].nextv(t,e);return this[Ut](n),n},t.prototype._all=async function(t){const e=await this[Mt].all(t);return this[Ut](e),e},t.prototype._seek=function(t,e){this[Mt].seek(t,e)},t.prototype._close=async function(){return this[Mt].close()};Bt.DefaultKeyIterator=Nt,Bt.DefaultValueIterator=Vt;var Ft={};const{AbstractIterator:Kt,AbstractKeyIterator:zt,AbstractValueIterator:qt}=ft,Gt=h,Wt=Symbol("nut"),Yt=Symbol("undefer"),Ht=Symbol("factory"),Jt=Symbol("signalOptions");let Qt=class extends Kt{constructor(t,e){super(t,e),this[Wt]=null,this[Ht]=()=>t.iterator(e),this[Jt]={signal:e.signal},this.db.defer((()=>this[Yt]()),this[Jt])}},Xt=class extends zt{constructor(t,e){super(t,e),this[Wt]=null,this[Ht]=()=>t.keys(e),this[Jt]={signal:e.signal},this.db.defer((()=>this[Yt]()),this[Jt])}},Zt=class extends qt{constructor(t,e){super(t,e),this[Wt]=null,this[Ht]=()=>t.values(e),this[Jt]={signal:e.signal},this.db.defer((()=>this[Yt]()),this[Jt])}};for(const t of[Qt,Xt,Zt])t.prototype[Yt]=function(){"open"===this.db.status&&(this[Wt]=this[Ht]())},t.prototype._next=async function(){if(null!==this[Wt])return this[Wt].next();if("opening"===this.db.status)return this.db.deferAsync((()=>this._next()),this[Jt]);throw new Gt("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})},t.prototype._nextv=async function(t,e){if(null!==this[Wt])return this[Wt].nextv(t,e);if("opening"===this.db.status)return this.db.deferAsync((()=>this._nextv(t,e)),this[Jt]);throw new Gt("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})},t.prototype._all=async function(t){if(null!==this[Wt])return this[Wt].all();if("opening"===this.db.status)return this.db.deferAsync((()=>this._all(t)),this[Jt]);throw new Gt("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})},t.prototype._seek=function(t,e){null!==this[Wt]?this[Wt]._seek(t,e):"opening"===this.db.status&&this.db.defer((()=>this._seek(t,e)),this[Jt])},t.prototype._close=async function(){return null!==this[Wt]?this[Wt].close():"opening"===this.db.status?this.db.deferAsync((()=>this._close())):void 0};Ft.DeferredIterator=Qt,Ft.DeferredKeyIterator=Xt,Ft.DeferredValueIterator=Zt;var te={},ee={},ne={prefixDescendantKey:function(t,e,n,r){for(;null!==n&&n!==r;)t=n.prefixKey(t,e,!0),n=n.parent;return t},isDescendant:function(t,e){for(;;){if(null==t.parent)return!1;if(t.parent===e)return!0;t=t.parent}}},re={};function oe(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}const{prefixDescendantKey:ie,isDescendant:se}=ne;function ce(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ae(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ce(Object(n),!0).forEach((function(e){c(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ce(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}re.PrewriteBatch=class{#d;#y;#g;constructor(t,e,n){this.#d=t,this.#y=e,this.#g=n}add(t){const e="put"===t.type,n=null!=t.sublevel,r=n?t.sublevel:this.#d;if(r._assertValidKey(t.key),t.keyEncoding=r.keyEncoding(t.keyEncoding),e)r._assertValidValue(t.value),t.valueEncoding=r.valueEncoding(t.valueEncoding);else if("del"!==t.type)throw new TypeError("A batch operation must have a type property that is 'put' or 'del'");const o=t.keyEncoding,i=o.encode(t.key),s=o.format,a=n&&!se(t.sublevel,this.#d)&&t.sublevel!==this.#d,u=n&&!a?ie(i,s,r,this.#d):i;n&&!a&&(t.sublevel=null);let l=null;if(null===this.#g||a||(l=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?oe(Object(n),!0).forEach((function(e){c(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):oe(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},t),l.encodedKey=u,n&&(l.key=u,l.keyEncoding=this.#d.keyEncoding(s)),this.#g.push(l)),t.key=a?u:this.#d.prefixKey(u,s,!0),t.keyEncoding=s,e){const e=t.valueEncoding,r=e.encode(t.value),o=e.format;t.value=r,t.valueEncoding=o,null!==l&&(l.encodedValue=r,n&&(l.value=r,l.valueEncoding=this.#d.valueEncoding(o)))}return this.#y.push(t),this}};const ue=nt,le=h,{getOptions:fe,emptyOptions:he,noop:pe}=ht,{prefixDescendantKey:de,isDescendant:ye}=ne,{PrewriteBatch:ge}=re,be=Symbol("publicOperations"),ve=Symbol("privateOperations");let we=class{#b="open";#v=0;#w=null;#g;#m;#O;#E;#j;constructor(t,e){if("object"!=typeof t||null===t){throw new TypeError(`The first argument must be an abstract-level database, received ${null===t?"null":typeof t}`)}const n=t.listenerCount("write")>0,r=!t.hooks.prewrite.noop;if(this.#g=n?[]:null,this.#j=!0===fe(e,he).add,r){const e=new me([],n?[]:null);this.#E=e,this.#O=new ge(t,e[ve],e[be]),this.#m=t.hooks.prewrite.run}else this.#E=null,this.#O=null,this.#m=null;this.db=t,this.db.attachResource(this)}get length(){return null!==this.#E?this.#v+this.#E.length:this.#v}put(t,e,n){this.#_();const r=null!=(n=fe(n,he)).sublevel,o=r?n.sublevel:this.db;o._assertValidKey(t),o._assertValidValue(e);const i=ae(ae({},n),{},{type:"put",key:t,value:e,keyEncoding:o.keyEncoding(n.keyEncoding),valueEncoding:o.valueEncoding(n.valueEncoding)});if(null!==this.#m)try{this.#m(i,this.#O),i.keyEncoding=o.keyEncoding(i.keyEncoding),i.valueEncoding=o.valueEncoding(i.valueEncoding)}catch(t){throw new le("The prewrite hook failed on batch.put()",{code:"LEVEL_HOOK_ERROR",cause:t})}const s=i.keyEncoding,c=s.encode(i.key),a=s.format,u=r&&!ye(i.sublevel,this.db)&&i.sublevel!==this.db,l=r&&!u?de(c,a,o,this.db):c,f=i.valueEncoding,h=f.encode(i.value),p=f.format;if(r&&!u&&(i.sublevel=null),null!==this.#g&&!u){const t=ae({},i);t.encodedKey=l,t.encodedValue=h,r&&(t.key=l,t.value=h,t.keyEncoding=this.db.keyEncoding(a),t.valueEncoding=this.db.valueEncoding(p)),this.#g.push(t)}return i.key=u?l:this.db.prefixKey(l,a,!0),i.value=h,i.keyEncoding=a,i.valueEncoding=p,this.#j?this._add(i):this._put(i.key,h,i),this.#v++,this}_put(t,e,n){}del(t,e){this.#_();const n=null!=(e=fe(e,he)).sublevel,r=n?e.sublevel:this.db;r._assertValidKey(t);const o=ae(ae({},e),{},{type:"del",key:t,keyEncoding:r.keyEncoding(e.keyEncoding)});if(null!==this.#m)try{this.#m(o,this.#O),o.keyEncoding=r.keyEncoding(o.keyEncoding)}catch(t){throw new le("The prewrite hook failed on batch.del()",{code:"LEVEL_HOOK_ERROR",cause:t})}const i=o.keyEncoding,s=i.encode(o.key),c=i.format,a=n?de(s,c,r,this.db):s;if(n&&(o.sublevel=null),null!==this.#g){const t=ae({},o);t.encodedKey=a,n&&(t.key=a,t.keyEncoding=this.db.keyEncoding(c)),this.#g.push(t)}return o.key=this.db.prefixKey(a,c,!0),o.keyEncoding=c,this.#j?this._add(o):this._del(o.key,o),this.#v++,this}_del(t,e){}_add(t){}clear(){return this.#_(),this._clear(),null!==this.#g&&(this.#g=[]),null!==this.#E&&this.#E.clear(),this.#v=0,this}_clear(){}async write(t){if(this.#_(),t=fe(t),0===this.#v)return this.close();{this.#b="writing";const e=this.#k();try{if(null!==this.#E){const t=this.#E[be],e=this.#E[ve],n=this.#E.length;for(let t=0;t<n;t++){const n=e[t];this.#j?this._add(n):"put"===n.type?this._put(n.key,n.value,n):this._del(n.key,n)}null!==t&&0!==n&&(this.#g=this.#g.concat(t))}await this._write(t)}catch(t){e();try{await this.#w}catch(e){t=ue([t,e])}throw t}return e(),null!==this.#g&&this.db.emit("write",this.#g),this.#w}}async _write(t){}async close(){return null!==this.#w?this.#w.catch(pe):(this.#k()(),this.#w)}async _close(){}#_(){if("open"!==this.#b)throw new le("Batch is not open: cannot change operations after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});if("open"!==this.db.status)throw new le("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})}#k(){let t;return this.#w=new Promise(((e,n)=>{t=()=>{this.#f().then(e,n)}})),t}async#f(){this.#b="closing",await this._close(),this.db.detachResource(this)}};"symbol"==typeof Symbol.asyncDispose&&(we.prototype[Symbol.asyncDispose]=async function(){return this.close()});class me{constructor(t,e){this[ve]=t,this[be]=e}get length(){return this[ve].length}clear(){for(const t of[be,ve]){const e=this[t];null!==e&&e.splice(0,e.length)}}}ee.AbstractChainedBatch=we;const{AbstractChainedBatch:Oe}=ee;te.DefaultChainedBatch=class extends Oe{#A=[];constructor(t){super(t,{add:!0})}_add(t){this.#A.push(t)}_clear(){this.#A=[]}async _write(t){return this.db._batch(this.#A,t)}};var Ee={};const{noop:je}=ht;class _e{#x=(()=>new Set)();#P;constructor(t){this.#P=t.async,this.noop=!0,this.run=this.#S()}add(t){ke(t),this.#x.add(t),this.noop=!1,this.run=this.#S()}delete(t){ke(t),this.#x.delete(t),this.noop=0===this.#x.size,this.run=this.#S()}#S(){if(this.noop)return je;if(1===this.#x.size){const[t]=this.#x;return t}if(this.#P){const t=async function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];for(const e of t)await e(...n)};return t.bind(null,Array.from(this.#x))}{const t=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];for(const e of t)e(...n)};return t.bind(null,Array.from(this.#x))}}}const ke=function(t){if("function"!=typeof t){throw new TypeError(`The first argument must be a function, received ${null===t?"null":typeof t}`)}};Ee.DatabaseHooks=class{constructor(){this.postopen=new _e({async:!0}),this.prewrite=new _e({async:!1}),this.newsub=new _e({async:!1})}};var Ae={};const{deprecate:xe}=ht;Ae.EventMonitor=class{constructor(t){this.write=!1;t.on("newListener",(t=>{"write"===t&&(this.write=!0),"put"!==t&&"del"!==t&&"batch"!==t||xe(`The '${t}' event has been removed in favor of 'write'`)})),t.on("removeListener",(e=>{"write"===e&&(this.write=t.listenerCount("write")>0)}))}};var Pe={};const{getOptions:Se,emptyOptions:Te}=ht,{AbortError:Ie}=yt;class Be{constructor(t,e){this.fn=t,this.signal=e}}Pe.DeferredQueue=class{#T;#I;constructor(){this.#T=[],this.#I=new Set}add(t,e){const n=(e=Se(e,Te)).signal;null!=n?n.aborted?t(new Ie):(this.#I.has(n)||(this.#I.add(n),n.addEventListener("abort",this.#B,{once:!0})),this.#T.push(new Be(t,n))):this.#T.push(new Be(t,null))}drain(){const t=this.#T,e=this.#I;this.#T=[],this.#I=new Set;for(const t of e)t.removeEventListener("abort",this.#B);for(const e of t)e.fn.call(null)}#B=t=>{const e=t.target,n=new Ie,r=[];this.#T=this.#T.filter((function(t){return null===t.signal||t.signal!==e||(r.push(t),!1)})),this.#I.delete(e);for(const t of r)t.fn.call(null,n)}};const $e=Object.prototype.hasOwnProperty,De=new Set(["lt","lte","gt","gte"]);var Le,Re={};const Me=["separator","manifest"];function Ce(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Ue(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ce(Object(n),!0).forEach((function(e){c(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ce(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var Ne,Ve;const Fe=["keyEncoding","valueEncoding","passive"];function Ke(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ze(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ke(Object(n),!0).forEach((function(e){c(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ke(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}const{supports:qe}=l,{Transcoder:Ge}=f,{EventEmitter:We}=t,Ye=h,He=nt,{AbstractIterator:Je}=ft,{DefaultKeyIterator:Qe,DefaultValueIterator:Xe}=Bt,{DeferredIterator:Ze,DeferredKeyIterator:tn,DeferredValueIterator:en}=Ft,{DefaultChainedBatch:nn}=te,{DatabaseHooks:rn}=Ee,{PrewriteBatch:on}=re,{EventMonitor:sn}=Ae,{getOptions:cn,noop:an,emptyOptions:un,resolvedPromise:ln}=ht,{prefixDescendantKey:fn,isDescendant:hn}=ne,{DeferredQueue:pn}=Pe,dn=function(t,e){const n={};for(const r in t)$e.call(t,r)&&"keyEncoding"!==r&&"valueEncoding"!==r&&(De.has(r)?n[r]=e.encode(t[r]):n[r]=t[r]);return n.reverse=!!n.reverse,n.limit=Number.isInteger(n.limit)&&n.limit>=0?n.limit:-1,n};let yn=class extends We{#b="opening";#$=!0;#D=null;#L=!1;#R;#M;#C;#U;#N;#V;#F;#K;constructor(t,e){if(super(),"object"!=typeof t||null===t)throw new TypeError("The first argument 'manifest' must be an object");e=cn(e);const{keyEncoding:r,valueEncoding:o,passive:i}=e,s=n(e,Fe);this.#R=new Set,this.#M=new pn,this.#C=s;const c=!1!==t.snapshots&&!1!==t.implicitSnapshots;this.hooks=new rn,this.supports=qe(t,{deferredOpen:!0,seek:!0,implicitSnapshots:c,permanence:!1!==t.permanence,encodings:t.encodings||{},events:ze(ze({},t.events),{},{opening:!0,open:!0,closing:!0,closed:!0,write:!0,clear:!0})}),this.#K=new sn(this),this.#N=new Ge(bn(this)),this.#V=this.#N.encoding(r||"utf8"),this.#F=this.#N.encoding(o||"utf8");for(const t of this.#N.encodings())this.supports.encodings[t.commonName]||(this.supports.encodings[t.commonName]=!0);this.#U={empty:un,entry:Object.freeze({keyEncoding:this.#V.commonName,valueEncoding:this.#F.commonName}),entryFormat:Object.freeze({keyEncoding:this.#V.format,valueEncoding:this.#F.format}),key:Object.freeze({keyEncoding:this.#V.commonName}),keyFormat:Object.freeze({keyEncoding:this.#V.format}),owner:Object.freeze({owner:this})},queueMicrotask((()=>{this.#$&&this.open({passive:!1}).catch(an)}))}get status(){return this.#b}get parent(){return null}keyEncoding(t){return this.#N.encoding(null!=t?t:this.#V)}valueEncoding(t){return this.#N.encoding(null!=t?t:this.#F)}async open(t){(t=ze(ze({},this.#C),cn(t))).createIfMissing=!1!==t.createIfMissing,t.errorIfExists=!!t.errorIfExists;const e=this.hooks.postopen.noop?null:this.hooks.postopen.run,n=t.passive;for(n&&this.#$&&await void 0,this.#z();null!==this.#D;)await this.#D.catch(an);if(this.#z(),n){if("open"!==this.#b)throw new mn}else if("closed"===this.#b||this.#$){this.#$=!1,this.#D=ln,this.#D=(async()=>{this.#b="opening";try{this.emit("opening"),await this._open(t)}catch(t){this.#b="closed",this.#M.drain();try{await this.#q()}catch(e){t=He([t,e])}throw new mn(t)}if(this.#b="open",null!==e){let n;try{this.#L=!0,await e(t)}catch(t){n=wn(t)}finally{this.#L=!1}if(n){this.#b="closing",this.#M.drain();try{await this.#q(),await this._close()}catch(t){this.#L=!0,n=He([n,t])}throw this.#b="closed",new Ye("The postopen hook failed on open()",{code:"LEVEL_HOOK_ERROR",cause:n})}}this.#M.drain(),this.emit("open")})();try{await this.#D}finally{this.#D=null}}else if("open"!==this.#b)throw new mn}async _open(t){}async close(){for(this.#z();null!==this.#D;)await this.#D.catch(an);if(this.#z(),"open"===this.#b||this.#$){const t=this.#$;this.#$=!1,this.#D=ln,this.#D=(async()=>{this.#b="closing",this.#M.drain();try{this.emit("closing"),await this.#q(),t||await this._close()}catch(t){throw this.#b="open",this.#M.drain(),new On(t)}this.#b="closed",this.#M.drain(),this.emit("closed")})();try{await this.#D}finally{this.#D=null}}else if("closed"!==this.#b)throw new On}async#q(){if(0===this.#R.size)return;const t=Array.from(this.#R),e=t.map(vn),n=await Promise.allSettled(e),r=[];for(let e=0;e<n.length;e++)"fulfilled"===n[e].status?this.#R.delete(t[e]):r.push(wn(n[e].reason));if(r.length>0)throw He(r)}async _close(){}async get(t,e){if(e=cn(e,this.#U.entry),"opening"===this.#b)return this.deferAsync((()=>this.get(t,e)));this.#G(),this._assertValidKey(t);const n=e.snapshot,r=this.keyEncoding(e.keyEncoding),o=this.valueEncoding(e.valueEncoding),i=r.format,s=o.format;e===this.#U.entry?e=this.#U.entryFormat:e.keyEncoding===i&&e.valueEncoding===s||(e=ze(ze({},e),{},{keyEncoding:i,valueEncoding:s}));const c=r.encode(t),a=this.prefixKey(c,i,!0);let u;null==n||n.ref();try{u=await this._get(a,e)}finally{null==n||n.unref()}try{return void 0===u?u:o.decode(u)}catch(t){throw new Ye("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:t})}}async _get(t,e){}getSync(t,e){if("open"!==this.status)throw new Ye("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});if(this._assertValidKey(t),null==e){const e=this.#V.encode(t),n=this.prefixKey(e,this.#V.format,!0),r=this._getSync(n,this.#U.entryFormat);try{return void 0!==r?this.#F.decode(r):void 0}catch(t){throw new Ye("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:t})}}const n=e.snapshot,r=this.keyEncoding(e.keyEncoding),o=this.valueEncoding(e.valueEncoding),i=r.format,s=o.format;e.keyEncoding===i&&e.valueEncoding===s||(e=ze(ze({},e),{},{keyEncoding:i,valueEncoding:s}));const c=r.encode(t),a=this.prefixKey(c,i,!0);let u;null==n||n.ref();try{u=this._getSync(a,e)}finally{null==n||n.unref()}try{return void 0!==u?o.decode(u):void 0}catch(t){throw new Ye("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:t})}}_getSync(t,e){throw new Ye("Database does not support getSync()",{code:"LEVEL_NOT_SUPPORTED"})}async getMany(t,e){if(e=cn(e,this.#U.entry),"opening"===this.#b)return this.deferAsync((()=>this.getMany(t,e)));if(this.#G(),!Array.isArray(t))throw new TypeError("The first argument 'keys' must be an array");if(0===t.length)return[];const n=e.snapshot,r=this.keyEncoding(e.keyEncoding),o=this.valueEncoding(e.valueEncoding),i=r.format,s=o.format;e===this.#U.entry?e=this.#U.entryFormat:e.keyEncoding===i&&e.valueEncoding===s||(e=ze(ze({},e),{},{keyEncoding:i,valueEncoding:s}));const c=new Array(t.length);for(let e=0;e<t.length;e++){const n=t[e];this._assertValidKey(n),c[e]=this.prefixKey(r.encode(n),i,!0)}let a;null==n||n.ref();try{a=await this._getMany(c,e)}finally{null==n||n.unref()}try{for(let t=0;t<a.length;t++)void 0!==a[t]&&(a[t]=o.decode(a[t]))}catch(t){throw new Ye(`Could not decode one or more of ${a.length} value(s)`,{code:"LEVEL_DECODE_ERROR",cause:t})}return a}async _getMany(t,e){return new Array(t.length).fill(void 0)}async has(t,e){if(e=cn(e,this.#U.key),"opening"===this.#b)return this.deferAsync((()=>this.has(t,e)));this.#G(),this._assertValidKey(t);const n=e.snapshot,r=this.keyEncoding(e.keyEncoding),o=r.format;e===this.#U.key?e=this.#U.keyFormat:e.keyEncoding!==o&&(e=ze(ze({},e),{},{keyEncoding:o}));const i=r.encode(t),s=this.prefixKey(i,o,!0);null==n||n.ref();try{return this._has(s,e)}finally{null==n||n.unref()}}async _has(t,e){throw new Ye("Database does not support has()",{code:"LEVEL_NOT_SUPPORTED"})}async hasMany(t,e){if(e=cn(e,this.#U.key),"opening"===this.#b)return this.deferAsync((()=>this.hasMany(t,e)));if(this.#G(),!Array.isArray(t))throw new TypeError("The first argument 'keys' must be an array");if(0===t.length)return[];const n=e.snapshot,r=this.keyEncoding(e.keyEncoding),o=r.format;e===this.#U.key?e=this.#U.keyFormat:e.keyEncoding!==o&&(e=ze(ze({},e),{},{keyEncoding:o}));const i=new Array(t.length);for(let e=0;e<t.length;e++){const n=t[e];this._assertValidKey(n),i[e]=this.prefixKey(r.encode(n),o,!0)}null==n||n.ref();try{return this._hasMany(i,e)}finally{null==n||n.unref()}}async _hasMany(t,e){throw new Ye("Database does not support hasMany()",{code:"LEVEL_NOT_SUPPORTED"})}async put(t,e,n){if(!this.hooks.prewrite.noop)return this.batch([{type:"put",key:t,value:e}],n);if(n=cn(n,this.#U.entry),"opening"===this.#b)return this.deferAsync((()=>this.put(t,e,n)));this.#G(),this._assertValidKey(t),this._assertValidValue(e);const r=this.keyEncoding(n.keyEncoding),o=this.valueEncoding(n.valueEncoding),i=r.format,s=o.format,c=this.#K.write,a=n;n===this.#U.entry?n=this.#U.entryFormat:n.keyEncoding===i&&n.valueEncoding===s||(n=ze(ze({},n),{},{keyEncoding:i,valueEncoding:s}));const u=r.encode(t),l=this.prefixKey(u,i,!0),f=o.encode(e);if(await this._put(l,f,n),c){const n=ze(ze({},a),{},{type:"put",key:t,value:e,keyEncoding:r,valueEncoding:o,encodedKey:u,encodedValue:f});this.emit("write",[n])}}async _put(t,e,n){}async del(t,e){if(!this.hooks.prewrite.noop)return this.batch([{type:"del",key:t}],e);if(e=cn(e,this.#U.key),"opening"===this.#b)return this.deferAsync((()=>this.del(t,e)));this.#G(),this._assertValidKey(t);const n=this.keyEncoding(e.keyEncoding),r=n.format,o=this.#K.write,i=e;e===this.#U.key?e=this.#U.keyFormat:e.keyEncoding!==r&&(e=ze(ze({},e),{},{keyEncoding:r}));const s=n.encode(t),c=this.prefixKey(s,r,!0);if(await this._del(c,e),o){const e=ze(ze({},i),{},{type:"del",key:t,keyEncoding:n,encodedKey:s});this.emit("write",[e])}}async _del(t,e){}batch(t,e){return arguments.length?(e=cn(e,this.#U.empty),this.#W(t,e)):(this.#G(),this._chainedBatch())}async#W(t,e){if("opening"===this.#b)return this.deferAsync((()=>this.#W(t,e)));if(this.#G(),!Array.isArray(t))throw new TypeError("The first argument 'operations' must be an array");if(0===t.length)return;const n=t.length,r=!this.hooks.prewrite.noop,o=this.#K.write,i=o?new Array(n):null,s=new Array(n),c=r?new on(this,s,i):null;for(let a=0;a<n;a++){const n=ze(ze({},e),t[a]),u="put"===n.type,l=null!=n.sublevel,f=l?n.sublevel:this;if(f._assertValidKey(n.key),n.keyEncoding=f.keyEncoding(n.keyEncoding),u)f._assertValidValue(n.value),n.valueEncoding=f.valueEncoding(n.valueEncoding);else if("del"!==n.type)throw new TypeError("A batch operation must have a type property that is 'put' or 'del'");if(r)try{this.hooks.prewrite.run(n,c),n.keyEncoding=f.keyEncoding(n.keyEncoding),u&&(n.valueEncoding=f.valueEncoding(n.valueEncoding))}catch(t){throw new Ye("The prewrite hook failed on batch()",{code:"LEVEL_HOOK_ERROR",cause:t})}const h=n.keyEncoding,p=h.encode(n.key),d=h.format,y=l&&!hn(n.sublevel,this)&&n.sublevel!==this,g=l&&!y?fn(p,d,f,this):p;l&&!y&&(n.sublevel=null);let b=null;if(o&&!y&&(b=ze({},n),b.encodedKey=g,l&&(b.key=g,b.keyEncoding=this.keyEncoding(d)),i[a]=b),n.key=y?g:this.prefixKey(g,d,!0),n.keyEncoding=d,u){const t=n.valueEncoding,e=t.encode(n.value),r=t.format;n.value=e,n.valueEncoding=r,o&&!y&&(b.encodedValue=e,l&&(b.value=e,b.valueEncoding=this.valueEncoding(r)))}s[a]=n}await this._batch(s,e),o&&this.emit("write",i)}async _batch(t,e){}sublevel(t,e){const n=gn.defaults(e),r=this._sublevel(t,n);if(!this.hooks.newsub.noop)try{this.hooks.newsub.run(r,n)}catch(t){throw new Ye("The newsub hook failed on sublevel()",{code:"LEVEL_HOOK_ERROR",cause:t})}return r}_sublevel(t,e){return new gn(this,t,e)}prefixKey(t,e,n){return t}async clear(t){if(t=cn(t,this.#U.empty),"opening"===this.#b)return this.deferAsync((()=>this.clear(t)));this.#G();const e=t,n=this.keyEncoding(t.keyEncoding),r=t.snapshot;if((t=dn(t,n)).keyEncoding=n.format,0!==t.limit){null==r||r.ref();try{await this._clear(t)}finally{null==r||r.unref()}this.emit("clear",e)}}async _clear(t){}iterator(t){var e,n;const r=this.keyEncoding(null===(e=t)||void 0===e?void 0:e.keyEncoding),o=this.valueEncoding(null===(n=t)||void 0===n?void 0:n.valueEncoding);return(t=dn(t,r)).keys=!1!==t.keys,t.values=!1!==t.values,t[Je.keyEncoding]=r,t[Je.valueEncoding]=o,t.keyEncoding=r.format,t.valueEncoding=o.format,"opening"===this.#b?new Ze(this,t):(this.#G(),this._iterator(t))}_iterator(t){return new Je(this,t)}keys(t){var e,n;const r=this.keyEncoding(null===(e=t)||void 0===e?void 0:e.keyEncoding),o=this.valueEncoding(null===(n=t)||void 0===n?void 0:n.valueEncoding);return(t=dn(t,r))[Je.keyEncoding]=r,t[Je.valueEncoding]=o,t.keyEncoding=r.format,t.valueEncoding=o.format,"opening"===this.#b?new tn(this,t):(this.#G(),this._keys(t))}_keys(t){return new Qe(this,t)}values(t){var e,n;const r=this.keyEncoding(null===(e=t)||void 0===e?void 0:e.keyEncoding),o=this.valueEncoding(null===(n=t)||void 0===n?void 0:n.valueEncoding);return(t=dn(t,r))[Je.keyEncoding]=r,t[Je.valueEncoding]=o,t.keyEncoding=r.format,t.valueEncoding=o.format,"opening"===this.#b?new en(this,t):(this.#G(),this._values(t))}_values(t){return new Xe(this,t)}snapshot(t){return this.#G(),"object"!=typeof t||null===t?t=this.#U.owner:null==t.owner&&(t=ze(ze({},t),{},{owner:this})),this._snapshot(t)}_snapshot(t){throw new Ye("Database does not support explicit snapshots",{code:"LEVEL_NOT_SUPPORTED"})}defer(t,e){if("function"!=typeof t)throw new TypeError("The first argument must be a function");this.#M.add((function(e){e||t()}),e)}deferAsync(t,e){if("function"!=typeof t)throw new TypeError("The first argument must be a function");return new Promise(((n,r)=>{this.#M.add((function(e){e?r(e):t().then(n,r)}),e)}))}attachResource(t){if("object"!=typeof t||null===t||"function"!=typeof t.close)throw new TypeError("The first argument must be a resource object");this.#R.add(t)}detachResource(t){this.#R.delete(t)}_chainedBatch(){return new nn(this)}_assertValidKey(t){if(null==t)throw new Ye("Key cannot be null or undefined",{code:"LEVEL_INVALID_KEY"})}_assertValidValue(t){if(null==t)throw new Ye("Value cannot be null or undefined",{code:"LEVEL_INVALID_VALUE"})}#G(){if("open"!==this.#b)throw new Ye("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})}#z(){if(this.#L)throw new Ye("Database status is locked",{code:"LEVEL_STATUS_LOCKED"})}};const{AbstractSublevel:gn}=function(){if(Ve)return Ne;Ve=1;const t=h,{Buffer:e}=m()||{},{AbstractSublevelIterator:r,AbstractSublevelKeyIterator:o,AbstractSublevelValueIterator:i}=function(){if(Le)return Re;Le=1;const{AbstractIterator:t,AbstractKeyIterator:e,AbstractValueIterator:n}=ft;return Re.AbstractSublevelIterator=class extends t{#Y;#H;constructor(t,e,n,r){super(t,e),this.#Y=n,this.#H=r}async _next(){const t=await this.#Y.next();if(void 0!==t){const e=t[0];void 0!==e&&(t[0]=this.#H(e))}return t}async _nextv(t,e){const n=await this.#Y.nextv(t,e),r=this.#H;for(const t of n){const e=t[0];void 0!==e&&(t[0]=r(e))}return n}async _all(t){const e=await this.#Y.all(t),n=this.#H;for(const t of e){const e=t[0];void 0!==e&&(t[0]=n(e))}return e}_seek(t,e){this.#Y.seek(t,e)}async _close(){return this.#Y.close()}},Re.AbstractSublevelKeyIterator=class extends e{#Y;#H;constructor(t,e,n,r){super(t,e),this.#Y=n,this.#H=r}async _next(){const t=await this.#Y.next();return void 0===t?t:this.#H(t)}async _nextv(t,e){const n=await this.#Y.nextv(t,e),r=this.#H;for(let t=0;t<n.length;t++){const e=n[t];void 0!==e&&(n[t]=r(e))}return n}async _all(t){const e=await this.#Y.all(t),n=this.#H;for(let t=0;t<e.length;t++){const r=e[t];void 0!==r&&(e[t]=n(r))}return e}_seek(t,e){this.#Y.seek(t,e)}async _close(){return this.#Y.close()}},Re.AbstractSublevelValueIterator=class extends n{#Y;constructor(t,e,n){super(t,e),this.#Y=n}async _next(){return this.#Y.next()}async _nextv(t,e){return this.#Y.nextv(t,e)}async _all(t){return this.#Y.all(t)}_seek(t,e){this.#Y.seek(t,e)}async _close(){return this.#Y.close()}},Re}(),s=Symbol("root"),c=new TextEncoder,a={separator:"!"};Ne=function(l){let{AbstractLevel:h}=l;class y extends h{#J;#Q;#X;#Z;#tt;#et;#H;static defaults(t){return null==t?a:t.separator?t:Ue(Ue({},t),{},{separator:"!"})}constructor(e,r,o){const i=y.defaults(o),{separator:a,manifest:l}=i,h=n(i,Me),g=[].concat(r).map((t=>d(t,a))),b=a.charCodeAt(0)+1,v=e[s]||e;if(!g.every((t=>c.encode(t).every((t=>t>b&&t<127)))))throw new t(`Sublevel name must use bytes > ${b} < 127`,{code:"LEVEL_INVALID_PREFIX"});super(u(e,l),h);const w=g.map((t=>a+t+a)).join(""),m=(e.prefix||"")+w,O=m.slice(0,-1)+String.fromCharCode(b);this[s]=v,this.#et=e,this.#X=g,this.#Z=e.prefix?e.path().concat(g):g,this.#J=new f(m),this.#tt=new f(O),this.#Q=new f(w),this.#H=new p}prefixKey(t,n,r){const o=r?this.#Q:this.#J;if("utf8"===n)return o.utf8+t;if(0===t.byteLength)return o[n];if("view"===n){const e=o.view,n=new Uint8Array(e.byteLength+t.byteLength);return n.set(e,0),n.set(t,e.byteLength),n}{const n=o.buffer;return e.concat([n,t],n.byteLength+t.byteLength)}}#nt(t,e){void 0!==t.gte?t.gte=this.prefixKey(t.gte,e,!1):void 0!==t.gt?t.gt=this.prefixKey(t.gt,e,!1):t.gte=this.#J[e],void 0!==t.lte?t.lte=this.prefixKey(t.lte,e,!1):void 0!==t.lt?t.lt=this.prefixKey(t.lt,e,!1):t.lte=this.#tt[e]}get prefix(){return this.#J.utf8}get db(){return this[s]}get parent(){return this.#et}path(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this.#X:this.#Z}async _open(t){await this.#et.open({passive:!0}),this.#et.attachResource(this)}async _close(){this.#et.detachResource(this)}async _put(t,e,n){return this.#et.put(t,e,n)}async _get(t,e){return this.#et.get(t,e)}_getSync(t,e){return this.#et.getSync(t,e)}async _getMany(t,e){return this.#et.getMany(t,e)}async _has(t,e){return this.#et.has(t,e)}async _hasMany(t,e){return this.#et.hasMany(t,e)}async _del(t,e){return this.#et.del(t,e)}async _batch(t,e){return this.#et.batch(t,e)}async _clear(t){return this.#nt(t,t.keyEncoding),this[s].clear(t)}_iterator(t){this.#nt(t,t.keyEncoding);const e=this[s].iterator(t),n=this.#H.get(this.#J.utf8.length,t.keyEncoding);return new r(this,t,e,n)}_keys(t){this.#nt(t,t.keyEncoding);const e=this[s].keys(t),n=this.#H.get(this.#J.utf8.length,t.keyEncoding);return new o(this,t,e,n)}_values(t){this.#nt(t,t.keyEncoding);const e=this[s].values(t);return new i(this,t,e)}_snapshot(t){return this[s].snapshot(t)}}return{AbstractSublevel:y}};const u=function(t,e){return Ue(Ue(Ue({},t.supports),{},{createIfMissing:!1,errorIfExists:!1,events:{},additionalMethods:{}},e),{},{encodings:{utf8:l(t,"utf8"),buffer:l(t,"buffer"),view:l(t,"view")}})},l=function(t,e){return!!t.supports.encodings[e]&&t.keyEncoding(e).name===e};class f{constructor(t){this.utf8=t,this.view=c.encode(t),this.buffer=e?e.from(this.view.buffer,0,this.view.byteLength):{}}}class p{constructor(){this.cache=new Map}get(t,e){let n=this.cache.get(e);return void 0===n&&(n="view"===e?function(t,e){return e.subarray(t)}.bind(null,t):function(t,e){return e.slice(t)}.bind(null,t),this.cache.set(e,n)),n}}const d=function(t,e){let n=0,r=t.length;for(;n<r&&t[n]===e;)n++;for(;r>n&&t[r-1]===e;)r--;return t.slice(n,r)};return Ne}()({AbstractLevel:yn});u.AbstractLevel=yn,u.AbstractSublevel=gn,"symbol"==typeof Symbol.asyncDispose&&(yn.prototype[Symbol.asyncDispose]=async function(){return this.close()});const bn=function(t){return Object.keys(t.supports.encodings).filter((e=>!!t.supports.encodings[e]))},vn=function(t){return t.close()},wn=function(t){if(t instanceof Error)return t;if("[object Error]"===Object.prototype.toString.call(t))return t;return new TypeError(`Promise rejection reason must be an Error, received ${null===t?"null":typeof t}`)};class mn extends Ye{constructor(t){super("Database failed to open",{code:"LEVEL_DATABASE_NOT_OPEN",cause:t})}}class On extends Ye{constructor(t){super("Database failed to close",{code:"LEVEL_DATABASE_NOT_CLOSED",cause:t})}}var En={};const jn=h,{noop:_n}=ht;class kn{#rt=!0;#ot=0;#e=null;#w=null;#it;constructor(t){const e=t.owner;if("object"!=typeof e||null===e){throw new TypeError(`Owner must be an abstract-level database, received ${null===e?"null":typeof e}`)}this.#it=e,this.#it.attachResource(this)}ref(){if(!this.#rt)throw new jn("Snapshot is not open: cannot use snapshot after close()",{code:"LEVEL_SNAPSHOT_NOT_OPEN"});this.#ot++}unref(){var t;0==--this.#ot&&(null===(t=this.#e)||void 0===t||t.call(this))}async close(){return null!==this.#w?this.#w.catch(_n):(this.#rt=!1,this.#w=new Promise(((t,e)=>{this.#e=()=>{this.#e=null,An(this,this.#it).then(t,e)}})),0===this.#ot&&this.#e(),this.#w)}async _close(){}}"symbol"==typeof Symbol.asyncDispose&&(kn.prototype[Symbol.asyncDispose]=async function(){return this.close()});const An=async function(t,e){await t._close(),e.detachResource(t)};En.AbstractSnapshot=kn,o.AbstractLevel=u.AbstractLevel,o.AbstractSublevel=u.AbstractSublevel,o.AbstractIterator=ft.AbstractIterator,o.AbstractKeyIterator=ft.AbstractKeyIterator,o.AbstractValueIterator=ft.AbstractValueIterator,o.AbstractChainedBatch=ee.AbstractChainedBatch,o.AbstractSnapshot=En.AbstractSnapshot;var xn={},Pn=function(t){const e=void 0!==t.gte?t.gte:void 0!==t.gt?t.gt:void 0,n=void 0!==t.lte?t.lte:void 0!==t.lt?t.lt:void 0,r=void 0===t.gte,o=void 0===t.lte;return void 0!==e&&void 0!==n?IDBKeyRange.bound(e,n,r,o):void 0!==e?IDBKeyRange.lowerBound(e,r):void 0!==n?IDBKeyRange.upperBound(n,o):null};const Sn=new TextEncoder;var Tn=function(t){return void 0===t||t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):Sn.encode(t)};function In(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Bn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?In(Object(n),!0).forEach((function(e){c(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):In(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}const{AbstractIterator:$n}=o,Dn=Pn,Ln=Tn,Rn=Symbol("cache"),Mn=Symbol("finished"),Cn=Symbol("options"),Un=Symbol("currentOptions"),Nn=Symbol("position"),Vn=Symbol("location"),Fn=Symbol("first"),Kn={};function zn(t){"function"==typeof t.commit&&t.commit()}xn.Iterator=class extends $n{constructor(t,e,n){super(t,n),this[Rn]=[],this[Mn]=0===this.limit,this[Cn]=n,this[Un]=Bn({},n),this[Nn]=void 0,this[Vn]=e,this[Fn]=!0}async _nextv(t,e){if(this[Fn]=!1,this[Mn])return[];if(this[Rn].length>0)return t=Math.min(t,this[Rn].length),this[Rn].splice(0,t);let n;void 0!==this[Nn]&&(this[Cn].reverse?(this[Un].lt=this[Nn],this[Un].lte=void 0):(this[Un].gt=this[Nn],this[Un].gte=void 0));try{n=Dn(this[Un])}catch(t){return this[Mn]=!0,[]}const r=this.db.db.transaction([this[Vn]],"readonly"),o=r.objectStore(this[Vn]),i=[],s=new Promise((function(t,e){r.onabort=()=>{e(r.error||new Error("aborted by user"))},r.oncomplete=()=>{t(i)}}));if(this[Cn].reverse){o[!this[Cn].values&&o.openKeyCursor?"openKeyCursor":"openCursor"](n,"prev").onsuccess=e=>{const n=e.target.result;if(n){const{key:e,value:o}=n;this[Nn]=e,i.push([this[Cn].keys&&void 0!==e?Ln(e):void 0,this[Cn].values&&void 0!==o?Ln(o):void 0]),i.length<t?n.continue():zn(r)}else this[Mn]=!0}}else{let e,s;const c=()=>{if(void 0===e||void 0===s)return;const n=Math.max(e.length,s.length);0===n||t===1/0?this[Mn]=!0:this[Nn]=e[n-1],i.length=n;for(let t=0;t<n;t++){const n=e[t],r=s[t];i[t]=[this[Cn].keys?Ln(n):void 0,this[Cn].values?Ln(r):void 0]}zn(r)};this[Cn].keys||t<1/0?o.getAllKeys(n,t<1/0?t:void 0).onsuccess=t=>{e=t.target.result,c()}:(e=[],c()),this[Cn].values?o.getAll(n,t<1/0?t:void 0).onsuccess=t=>{s=t.target.result,c()}:(s=[],c())}return s}async _next(){if(this[Rn].length>0)return this[Rn].shift();if(!this[Mn]){let t=Math.min(100,this.limit-this.count);return this[Fn]&&(this[Fn]=!1,t=1),this[Rn]=await this._nextv(t,Kn),this[Rn].shift()}}async _all(t){this[Fn]=!1;const e=this[Rn].splice(0,this[Rn].length),n=this.limit-this.count-e.length;if(n<=0)return e;let r=await this._nextv(n,Kn);return e.length>0&&(r=e.concat(r)),r}_seek(t,e){let n;this[Fn]=!0,this[Rn]=[],this[Mn]=!1,this[Nn]=void 0,this[Un]=Bn({},this[Cn]);try{n=Dn(this[Cn])}catch(t){return void(this[Mn]=!0)}null===n||n.includes(t)?this[Cn].reverse?this[Un].lte=t:this[Un].gte=t:this[Mn]=!0}};const qn=["prefix","version"],{AbstractLevel:Gn}=o,{Iterator:Wn}=xn,Yn=Tn,Hn=async function(t,e,n,r){if(0===r.limit)return;const o=t.db.transaction([e],"readwrite"),i=o.objectStore(e);let s=0;const c=new Promise((function(t,e){o.oncomplete=t,o.onabort=function(){e(o.error||new Error("aborted by user"))}})),a=i.openKeyCursor?"openKeyCursor":"openCursor",u=r.reverse?"prev":"next";return i[a](n,u).onsuccess=function(t){const e=t.target.result;e&&(i.delete(e.key).onsuccess=function(){(r.limit<=0||++s<r.limit)&&e.continue()})},c},Jn=Pn,Qn="level-js-",Xn=Symbol("idb"),Zn=Symbol("namePrefix"),tr=Symbol("location"),er=Symbol("version"),nr=Symbol("store"),rr=Symbol("onComplete");class or extends Gn{constructor(t,e){const r=e||{},{prefix:o,version:i}=r;if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0,has:!0,getSync:!1},n(r,qn)),"string"!=typeof t||""===t)throw new TypeError("The first argument 'location' must be a non-empty string");this[tr]=t,this[Zn]=null==o?Qn:o,this[er]=parseInt(i||1,10),this[Xn]=null}get location(){return this[tr]}get namePrefix(){return this[Zn]}get version(){return this[er]}get db(){return this[Xn]}get type(){return"browser-level"}async _open(t){const e=indexedDB.open(this[Zn]+this[tr],this[er]);return e.onupgradeneeded=t=>{const e=t.target.result;e.objectStoreNames.contains(this[tr])||e.createObjectStore(this[tr])},new Promise(((t,n)=>{e.onerror=function(){n(e.error||new Error("unknown error"))},e.onsuccess=()=>{this[Xn]=e.result,t()}}))}[nr](t){return this[Xn].transaction([this[tr]],t).objectStore(this[tr])}[rr](t){const e=t.transaction;return new Promise((function(n,r){e.onabort=function(){r(e.error||new Error("aborted by user"))},e.oncomplete=function(){n(t.result)}}))}async _get(t,e){const n=this[nr]("readonly").get(t),r=await this[rr](n);return Yn(r)}async _getMany(t,e){const n=this[nr]("readonly"),r=t.values(),o=Math.min(16,t.length),i=new Array(o),s=new Array(t.length);let c=0,a=!1;const u=async function(){try{for(const t of r){if(a)break;const e=c++,r=n.get(t);await new Promise((function(t,n){r.onsuccess=()=>{s[e]=Yn(r.result),t()},r.onerror=t=>{t.stopPropagation(),n(r.error)}}))}}catch(t){throw a=!0,t}};for(let t=0;t<o;t++)i[t]=u();return await Promise.allSettled(i),s}async _has(t,e){const n=this[nr]("readonly").count(t);return 1===await this[rr](n)}async _hasMany(t,e){const n=this[nr]("readonly"),r=t.values(),o=Math.min(16,t.length),i=new Array(o),s=new Array(t.length);let c=0,a=!1;const u=async function(){try{for(const t of r){if(a)break;const e=c++,r=n.count(t);await new Promise((function(t,n){r.onsuccess=()=>{s[e]=1===r.result,t()},r.onerror=t=>{t.stopPropagation(),n(r.error)}}))}}catch(t){throw a=!0,t}};for(let t=0;t<o;t++)i[t]=u();return await Promise.allSettled(i),s}async _del(t,e){const n=this[nr]("readwrite").delete(t);return this[rr](n)}async _put(t,e,n){const r=this[nr]("readwrite").put(e,t);return this[rr](r)}_iterator(t){return new Wn(this,this[tr],t)}async _batch(t,e){const n=this[nr]("readwrite"),r=n.transaction;let o,i=0;const s=new Promise((function(t,e){r.onabort=function(){e(o||r.error||new Error("aborted by user"))},r.oncomplete=t}));return function e(){const s=t[i++],c=s.key;let a;try{a="del"===s.type?n.delete(c):n.put(s.value,c)}catch(t){return o=t,void r.abort()}i<t.length?a.onsuccess=e:"function"==typeof r.commit&&r.commit()}(),s}async _clear(t){let e;try{e=Jn(t)}catch(t){return}if(t.limit>=0)return Hn(this,this[tr],e,t);const n=this[nr]("readwrite"),r=e?n.delete(e):n.clear();return this[rr](r)}async _close(){this[Xn].close()}}or.destroy=async function(t,e){null==e&&(e=Qn);const n=indexedDB.deleteDatabase(e+t);return new Promise((function(t,e){n.onsuccess=t,n.onerror=e}))},r.BrowserLevel=or;var ir=r.BrowserLevel;function sr(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function cr(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?sr(Object(n),!0).forEach((function(e){c(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):sr(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}class ar extends Error{}const ur=Symbol("missing"),lr=Object.freeze(new Error("mingo: cycle detected while processing object/array")),fr=t=>{const e=Nr(t);let n=0,r=e.length;for(;r;)n=(n<<5)-n^e.charCodeAt(--r);return n>>>0},hr=t=>"object"!=typeof t&&"function"!=typeof t||null===t,pr=t=>hr(t)||Ar(t)||xr(t),dr={undefined:1,null:2,number:3,string:4,symbol:5,object:6,array:7,arraybuffer:8,boolean:9,date:10,regexp:11,function:12},yr=(t,e)=>{t===ur&&(t=void 0),e===ur&&(e=void 0);const[n,r]=[t,e].map((t=>dr[wr(t)]||0));return n!==r?n-r:Ur(t,e)?0:t<e?-1:t>e?1:0};class gr extends Map{#st=(()=>fr)();#ct=(()=>new Map)();#at=t=>{const e=this.#st(t);return[(this.#ct.get(e)||[]).find((e=>Ur(e,t))),e]};constructor(){super()}static init(t){const e=new gr;return t&&(e.#st=t),e}clear(){super.clear(),this.#ct.clear()}delete(t){if(hr(t))return super.delete(t);const[e,n]=this.#at(t);return!!super.delete(e)&&(this.#ct.set(n,this.#ct.get(n).filter((t=>!Ur(t,e)))),!0)}get(t){if(hr(t))return super.get(t);const[e,n]=this.#at(t);return super.get(e)}has(t){if(hr(t))return super.has(t);const[e,n]=this.#at(t);return super.has(e)}set(t,e){if(hr(t))return super.set(t,e);const[n,r]=this.#at(t);if(super.has(n))super.set(n,e);else{super.set(t,e);const n=this.#ct.get(r)||[];n.push(t),this.#ct.set(r,n)}return this}get size(){return super.size}}function br(t,e){if(!t)throw new ar(e)}const vr=Object.keys(dr).reduce(((t,e)=>(t["[object "+e[0].toUpperCase()+e.substring(1)+"]"]=e,t)),{});function wr(t){var e,n;const r=Object.prototype.toString.call(t);return"[object Object]"===r?(null==t||null===(e=t.constructor)||void 0===e||null===(n=e.name)||void 0===n?void 0:n.toLowerCase())||"object":vr[r]||r.substring(8,r.length-1).toLowerCase()}const mr=t=>"boolean"==typeof t,Or=t=>"string"==typeof t,Er=t=>!isNaN(t)&&"number"==typeof t,jr=Array.isArray;function _r(t){if(!t)return!1;const e=Object.getPrototypeOf(t);return(e===Object.prototype||null===e)&&"object"===wr(t)}const kr=t=>!hr(t),Ar=t=>t instanceof Date,xr=t=>t instanceof RegExp,Pr=t=>"function"==typeof t,Sr=t=>null==t,Tr=function(t){return!!t||(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&""===t},Ir=t=>Sr(t)||Or(t)&&!t||jr(t)&&0===t.length||_r(t)&&0===Object.keys(t).length,Br=t=>jr(t)?t:[t],$r=(t,e)=>!!t&&Object.prototype.hasOwnProperty.call(t,e),Dr=(t,e)=>{if(Sr(t)||mr(t)||Er(t)||Or(t))return t;if(Ar(t))return new Date(t);if(xr(t))return new RegExp(t);if((t=>"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView(t))(t)){return new(0,t.constructor)(t)}if(e instanceof Set||(e=new Set),e.has(t))throw lr;e.add(t);try{if(jr(t)){const n=new Array(t.length);for(let r=0;r<t.length;r++)n[r]=Dr(t[r],e);return n}if(_r(t)){const n={};for(const r of Object.keys(t))n[r]=Dr(t[r],e);return n}}finally{e.delete(t)}return t},Lr=t=>t===ur;function Rr(t,e){if(Lr(t)||Sr(t))return e;if(Lr(e)||Sr(e))return t;if(hr(t)||hr(e))return e;jr(t)&&jr(e)&&br(t.length===e.length,"arrays must be of equal length to merge.");for(const n of Object.keys(e))t[n]=Rr(t[n],e[n]);return t}function Mr(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=new Array;return function t(e,r){for(let o=0,i=e.length;o<i;o++)jr(e[o])&&(r>0||r<0)?t(e[o],Math.max(-1,r-1)):n.push(e[o])}(t,e),n}function Cr(t){for(;t;){if(Object.getOwnPropertyNames(t).includes("toString"))return t.toString!==Object.prototype.toString;t=Object.getPrototypeOf(t)}return!1}function Ur(t,e){if(t===e||Object.is(t,e))return!0;if(null===t||null===e)return!1;if(typeof t!=typeof e)return!1;if("object"!=typeof t)return!1;if(t.constructor!==e.constructor)return!1;if(t instanceof Date)return+t==+e;if(t instanceof RegExp)return t.toString()===e.toString();const n=t.constructor;if(n===Array||n===Object){const n=Object.keys(t).sort(),r=Object.keys(e).sort();if(n.length!==r.length)return!1;for(let o=0,i=n[o];o<n.length;i=n[++o])if(i!==r[o]||!Ur(t[i],e[i]))return!1;return!0}return Cr(t)&&t.toString()===e.toString()}const Nr=(t,e)=>{if(null===t)return"null";if(void 0===t)return"undefined";if(Or(t)||Er(t)||mr(t))return JSON.stringify(t);if(Ar(t))return t.toISOString();if(xr(t)||(t=>"symbol"==typeof t)(t)||Pr(t))return t.toString();if(e instanceof Set||(e=new Set),e.has(t))throw lr;try{if(e.add(t),jr(t))return"["+t.map((t=>Nr(t,e))).join(",")+"]";if(_r(t)){return"{"+Object.keys(t).sort().map((n=>`${n}:${Nr(t[n],e)}`)).join()+"}"}const n=Cr(t)?t.toString():Nr(function(t){const e={};for(;t;){for(const n of Object.getOwnPropertyNames(t))n in e||(e[n]=t[n]);t=Object.getPrototypeOf(t)}return e}(t),e);return wr(t)+"("+n+")"}finally{e.delete(t)}};function Vr(t,e){return Sr(t)?null:(e=e||fr)(t)}function Fr(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:fr;if(t.length<1)return new Map;const r=new Map,o=new Map;for(let i=0;i<t.length;i++){const s=t[i],c=e(s,i),a=Vr(c,n);if(null===a)o.has(null)?o.get(null).push(s):o.set(null,[s]);else{const t=r.has(a)?r.get(a).find((t=>Ur(t,c))):null;Sr(t)?(o.set(c,[s]),r.has(a)?r.get(a).push(c):r.set(a,[c])):o.get(t).push(s)}}return o}function Kr(t,e){return kr(t)?t[e]:void 0}function zr(t,e,n){let r=0;const o=pr(t)?t:function t(e,n){let o=e;for(let e=0;e<n.length;e++){const i=n[e];if(null===/^\d+$/.exec(i)&&jr(o)){if(0===e&&r>0)break;r+=1;const i=n.slice(e);o=o.reduce(((e,n)=>{const r=t(n,i);return void 0!==r&&e.push(r),e}),[]);break}if(o=Kr(o,i),void 0===o)break}return o}(t,e.split("."));return jr(o)&&null!=n&&n.unwrapArray?function(t,e){if(e<1)return t;for(;e--&&1===t.length;)t=t[0];return t}(o,r):o}function qr(t,e,n){const r=e.indexOf("."),o=-1==r?e:e.substring(0,r),i=e.substring(r+1),s=-1!=r;if(jr(t)){const r=/^\d+$/.test(o),c=r&&null!=n&&n.preserveIndex?[...t]:[];if(r){const e=parseInt(o);let r=Kr(t,e);s&&(r=qr(r,i,n)),null!=n&&n.preserveIndex?c[e]=r:c.push(r)}else for(const r of t){const t=qr(r,e,n);null!=n&&n.preserveMissing?c.push(null==t?ur:t):(null!=t||null!=n&&n.preserveIndex)&&c.push(t)}return c}const c=null!=n&&n.preserveKeys?cr({},t):{};let a=Kr(t,o);if(s&&(a=qr(a,i,n)),void 0!==a)return c[o]=a,c}function Gr(t){if(jr(t))for(let e=t.length-1;e>=0;e--)t[e]===ur?t.splice(e,1):Gr(t[e]);else if(_r(t))for(const e in t)$r(t,e)&&Gr(t[e])}const Wr=/^\d+$/;function Yr(t,e,n,r){const o=e.split("."),i=o[0],s=o.slice(1).join(".");if(1===o.length)(_r(t)||jr(t)&&Wr.test(i))&&n(t,i);else{null!=r&&r.buildGraph&&Sr(t[i])&&(t[i]={});const e=t[i];if(!e)return;const c=!!(o.length>1&&Wr.test(o[1]));jr(e)&&null!=r&&r.descendArray&&!c?e.forEach((t=>Yr(t,s,n,r))):Yr(e,s,n,r)}}function Hr(t,e,n){Yr(t,e,((t,e)=>{t[e]=Pr(n)?n(t[e]):n}),{buildGraph:!0})}function Jr(t,e,n){Yr(t,e,((t,e)=>{if(jr(t)){if(/^\d+$/.test(e))t.splice(parseInt(e),1);else if(n&&n.descendArray)for(const n of t)_r(n)&&delete n[e]}else _r(t)&&delete t[e]}),n)}const Qr=/^\$[a-zA-Z0-9_]+$/;function Xr(t){return Qr.test(t)}function Zr(t){if(pr(t))return xr(t)?{$regex:t}:{$eq:t};if(kr(t)){if(!Object.keys(t).some(Xr))return{$eq:t};if($r(t,"$regex")){const e=cr({},t);return e.$regex=new RegExp(t.$regex,t.$options),delete e.$options,e}}return t}function to(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function eo(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?to(Object(n),!0).forEach((function(e){c(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):to(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var no=(t=>(t[t.CLONE_OFF=0]="CLONE_OFF",t[t.CLONE_INPUT=1]="CLONE_INPUT",t[t.CLONE_OUTPUT=2]="CLONE_OUTPUT",t[t.CLONE_ALL=3]="CLONE_ALL",t))(no||{});class ro{#C;#ut;#lt;constructor(t,e,n){this.#C=t,this.update(e,n)}static init(t,e,n){var r,o;return t instanceof ro?new ro(t.#C,null!==(r=t.root)&&void 0!==r?r:e,eo(eo(eo({},t.#lt),n),{},{variables:Object.assign({},null===(o=t.#lt)||void 0===o?void 0:o.variables,null==n?void 0:n.variables)})):new ro(t,e,n)}update(t,e){var n;this.#ut=t;const r=Object.assign({},null===(n=this.#lt)||void 0===n?void 0:n.variables,null==e?void 0:e.variables);return Object.keys(r).length?this.#lt=eo(eo({},e),{},{variables:r}):this.#lt=null!=e?e:{},this}getOptions(){return Object.freeze(eo(eo({},this.#C),{},{context:io.from(this.#C.context)}))}get root(){return this.#ut}get local(){return this.#lt}get idKey(){return this.#C.idKey}get collation(){var t;return null===(t=this.#C)||void 0===t?void 0:t.collation}get processingMode(){var t;return(null===(t=this.#C)||void 0===t?void 0:t.processingMode)||0}get useStrictMode(){var t;return null===(t=this.#C)||void 0===t?void 0:t.useStrictMode}get scriptEnabled(){var t;return null===(t=this.#C)||void 0===t?void 0:t.scriptEnabled}get useGlobalContext(){var t;return null===(t=this.#C)||void 0===t?void 0:t.useGlobalContext}get hashFunction(){var t;return null===(t=this.#C)||void 0===t?void 0:t.hashFunction}get collectionResolver(){var t;return null===(t=this.#C)||void 0===t?void 0:t.collectionResolver}get jsonSchemaValidator(){var t;return null===(t=this.#C)||void 0===t?void 0:t.jsonSchemaValidator}get variables(){var t;return null===(t=this.#C)||void 0===t?void 0:t.variables}get context(){var t;return null===(t=this.#C)||void 0===t?void 0:t.context}}function oo(t){return t instanceof ro?t.getOptions():Object.freeze(eo(eo({idKey:"_id",scriptEnabled:!0,useStrictMode:!0,useGlobalContext:!0,processingMode:0},t),{},{context:null!=t&&t.context?io.from(null==t?void 0:t.context):io.init()}))}class io{#ft=(()=>new Map)();constructor(){}static init(){return new io}static from(t){const e=io.init();return Sr(t)||t.#ft.forEach(((t,n)=>e.addOperators(n,t))),e}addOperators(t,e){this.#ft.has(t)||this.#ft.set(t,{});for(const[n,r]of Object.entries(e))this.getOperator(t,n)||(this.#ft.get(t)[n]=r);return this}getOperator(t,e){var n,r;return null!==(r=(null!==(n=this.#ft.get(t))&&void 0!==n?n:{})[e])&&void 0!==r?r:null}addAccumulatorOps(t){return this.addOperators("accumulator",t)}addExpressionOps(t){return this.addOperators("expression",t)}addQueryOps(t){return this.addOperators("query",t)}addPipelineOps(t){return this.addOperators("pipeline",t)}addProjectionOps(t){return this.addOperators("projection",t)}addWindowOps(t){return this.addOperators("window",t)}}const so=io.init();function co(t,e){for(const[n,r]of Object.entries(e)){br(Pr(r)&&Xr(n),`'${n}' is not a valid operator`);const e=ao(t,n,null);br(!e||r===e,`${n} already exists for '${t}' operators. Cannot change operator function once registered.`)}switch(t){case"accumulator":so.addAccumulatorOps(e);break;case"expression":so.addExpressionOps(e);break;case"pipeline":so.addPipelineOps(e);break;case"projection":so.addProjectionOps(e);break;case"query":so.addQueryOps(e);break;case"window":so.addWindowOps(e)}}function ao(t,e,n){const{context:r,useGlobalContext:o}=n||{},i=r?r.getOperator(t,e):null;return!i&&o?so.getOperator(t,e):i}function uo(t,e,n,r){const o=ro.init(r,t);return n&&Xr(n)?ho(t,e,n,o):fo(t,e,o)}const lo=["$$ROOT","$$CURRENT","$$REMOVE","$$NOW"];function fo(t,e,n){if(Or(e)&&e.length>0&&"$"===e[0]){if(po.includes(e))return e;let o=n.root;const i=e.split(".");if(lo.includes(i[0])){switch(i[0]){case"$$ROOT":break;case"$$CURRENT":o=t;break;case"$$REMOVE":o=void 0;break;case"$$NOW":o=new Date}e=e.slice(i[0].length+1)}else if("$$"===i[0].slice(0,2)){var r;o=Object.assign({},n.variables,{this:t},null==n||null===(r=n.local)||void 0===r?void 0:r.variables);const s=i[0].slice(2);br($r(o,s),`Use of undefined variable: ${s}`),e=e.slice(2)}else e=e.slice(1);return""===e?o:zr(o,e)}if(jr(e))return e.map((e=>fo(t,e,n)));if(_r(e)){const r={},o=Object.entries(e);for(const[e,i]of o){if(Xr(e))return br(1==o.length,"expression must have single operator."),ho(t,i,e,n);r[e]=fo(t,i,n)}return r}return e}function ho(t,e,n,r){const o=ao("expression",n,r);if(o)return o(t,e,r);const i=ao("accumulator",n,r);return br(!!i,`accumulator '${n}' is not registered.`),jr(t)||(t=fo(t,e,r),e=null),br(jr(t),`arguments must resolve to array for ${n}.`),i(t,e,r)}const po=["$$KEEP","$$PRUNE","$$DESCEND"];var yo=Object.freeze({__proto__:null,$and:(t,e,n)=>{const r=uo(t,e,null,n);return Tr(r,n.useStrictMode)&&r.every((t=>Tr(t,n.useStrictMode)))},$not:(t,e,n)=>{const r=Br(e);return 0!=r.length&&(br(1==r.length,"Expression $not takes exactly 1 argument"),!uo(t,r[0],null,n))},$or:(t,e,n)=>{const r=uo(t,e,null,n),o=n.useStrictMode;return Tr(r,o)&&r.some((t=>Tr(t,o)))}});function go(t){return t instanceof wo?t:new wo(t)}function bo(t,e){const n=t.slice(e+1);t.splice(e),Array.prototype.push.apply(t,n)}const vo=new Error;class wo{constructor(t){let e;if(this.#ht=[],this.#pt=[],this.isDone=!1,t instanceof Function&&(t={next:t}),(n=t)&&"object"==typeof n&&(null==n?void 0:n.next)instanceof Function){const n=t;e=()=>{const t=n.next();if(t.done)throw vo;return t.value}}else if(jr(t)){const n=t,r=n.length;let o=0;e=()=>{if(o<r)return n[o++];throw vo}}else if(!(t instanceof Function))throw new ar("Lazy must be initialized with an array, generator, or function.");var n;this.#dt=function(t,e,n){let r=!1,o=-1,i=0;return function(s){try{t:for(;!r;){let c=t();o++;let a=-1;const u=e.length;let l=!1;for(;++a<u;){const t=e[a];switch(t.action){case 0:c=t.func(c,o);break;case 1:if(!t.func(c,o))continue t;break;case 2:--t.count,t.count||(l=!0);break;case 3:--t.count,t.count||bo(e,a);continue t;default:break t}}if(r=l,!s)return{value:c,done:!1};n[i++]=c}}catch(t){if(t!==vo)throw t}return r=!0,{done:r}}}(e,this.#ht,this.#pt)}#ht;#pt;#dt;push(t,e){return"function"==typeof e?this.#ht.push({action:t,func:e}):"number"==typeof e&&this.#ht.push({action:t,count:e}),this}next(){return this.#dt()}map(t){return this.push(0,t)}filter(t){return this.push(1,t)}take(t){return t>0?this.push(2,t):this}drop(t){return t>0?this.push(3,t):this}transform(t){const e=this;let n;return go((()=>(n||(n=go(t(e.value()))),n.next())))}value(){return this.isDone||(this.isDone=this.#dt(!0).done),this.#pt}each(t){for(;;){const e=this.next();if(e.done)break;if(!1===t(e.value))return!1}return!0}reduce(t,e){let n=this.next();for(void 0!==e||n.done||(e=n.value,n=this.next());!n.done;)e=t(e,n.value),n=this.next();return e}size(){return this.reduce(((t,e)=>++t),0)}[Symbol.iterator](){return this}}const mo=(t,e,n)=>t.take(e);function Oo(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}const Eo=(t,e,n)=>Ir(e)?t:(_o(e,n),t.map(jo(e,ro.init(n))));function jo(t,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const r=e.idKey,o=Object.keys(t),i=new Array,s=new Array,a={};for(const r of o){const o=t[r];if(Er(o)||mr(o))o?s.push(r):i.push(r);else if(jr(o))a[r]=t=>o.map((n=>{var r;return null!==(r=uo(t,n,null,e.update(t)))&&void 0!==r?r:null}));else if(_r(o)){const t=Object.keys(o),i=1==t.length?t[0]:"",s=ao("projection",i,e);if(s){"$slice"===i&&!Br(o[i]).every(Er)?a[r]=t=>uo(t,o,r,e.update(t)):a[r]=t=>s(t,o[i],r,e.update(t))}else Xr(i)?a[r]=t=>uo(t,o[i],i,e):(_o(o,e),a[r]=t=>{if(!$r(t,r))return uo(t,o,null,e);n&&e.update(t);const i=zr(t,r),s=jo(o,e,!1);return jr(i)?i.map(s):_r(i)?s(i):s(t)})}else a[r]=Or(o)&&"$"===o[0]?t=>uo(t,o,r,e):t=>o}const u=Object.keys(a),l=i.includes(r);if(n&&l&&1===i.length&&!s.length&&!u.length)return t=>{const e=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Oo(Object(n),!0).forEach((function(e){c(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Oo(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},t);return delete e[r],e};const f=n&&!l&&!s.includes(r),h={preserveMissing:!0};return t=>{const e={};if(i.length&&!s.length){Rr(e,t);for(const t of i)Jr(e,t,{descendArray:!0})}for(const r of s){var n;Rr(e,null!==(n=qr(t,r,h))&&void 0!==n?n:{})}s.length&&Gr(e);for(const n of u){const r=a[n](t);void 0===r?Jr(e,n,{descendArray:!0}):Hr(e,n,r)}return f&&$r(t,r)&&(e[r]=zr(t,r)),e}}function _o(t,e){let n=!1,r=!1;for(const[o,i]of Object.entries(t))br(!o.startsWith("$"),"Field names may not start with '$'."),br(!o.endsWith(".$"),"Positional projection operator '$' is not supported."),o!==(null==e?void 0:e.idKey)&&(0===i||!1===i?n=!0:1!==i&&!0!==i||(r=!0),br(!(n&&r),"Projection cannot have a mix of inclusion and exclusion."))}const ko=(t,e,n)=>t.drop(e),Ao=(t,e,n)=>{if(Ir(e)||!_r(e))return t;let r=yr;const o=n.collation;return _r(o)&&Or(o.locale)&&(r=function(t){const e={sensitivity:xo[t.strength||3],caseFirst:"off"===t.caseFirst?"false":t.caseFirst||"false",numeric:t.numericOrdering||!1,ignorePunctuation:"shifted"===t.alternate};!0===(t.caseLevel||!1)&&("base"===e.sensitivity&&(e.sensitivity="case"),"accent"===e.sensitivity&&(e.sensitivity="variant"));const n=new Intl.Collator(t.locale,e);return(t,e)=>{if(!Or(t)||!Or(e))return yr(t,e);const r=n.compare(t,e);return r<0?-1:r>0?1:0}}(o)),t.transform((t=>{const o=Object.keys(e);for(const i of o.reverse()){const o=Fr(t,(t=>zr(t,i)),n.hashFunction),s=Array.from(o.keys()).sort(r);-1===e[i]&&s.reverse();let c=0;for(const e of s)for(const n of o.get(e))t[c++]=n;br(c==t.length,"bug: counter must match collection size.")}return t}))},xo={1:"base",2:"accent",3:"variant"};function Po(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function So(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Po(Object(n),!0).forEach((function(e){c(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Po(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}const To={$sort:Ao,$skip:ko,$limit:mo};class Io{#yt;#gt;#bt;#C;#ft={};#vt=null;#wt=[];constructor(t,e,n,r){this.#yt=t,this.#gt=e,this.#bt=n,this.#C=r}fetch(){if(this.#vt)return this.#vt;this.#vt=go(this.#yt).filter(this.#gt);const t=this.#C.processingMode;t&no.CLONE_INPUT&&this.#vt.map(Dr);for(const t of["$sort","$skip","$limit"])$r(this.#ft,t)&&(this.#vt=To[t](this.#vt,this.#ft[t],this.#C));return Object.keys(this.#bt).length&&(this.#vt=Eo(this.#vt,this.#bt,this.#C)),t&no.CLONE_OUTPUT&&this.#vt.map(Dr),this.#vt}fetchAll(){const t=go([...this.#wt]);return this.#wt=[],function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];let r=0;return go((()=>{for(;r<e.length;){const t=e[r].next();if(!t.done)return t;r++}return{done:!0}}))}(t,this.fetch())}all(){return this.fetchAll().value()}count(){return this.all().length}skip(t){return this.#ft.$skip=t,this}limit(t){return this.#ft.$limit=t,this}sort(t){return this.#ft.$sort=t,this}collation(t){return this.#C=So(So({},this.#C),{},{collation:t}),this}next(){if(this.#wt.length>0)return this.#wt.pop();const t=this.fetch().next();return t.done?void 0:t.value}hasNext(){if(this.#wt.length>0)return!0;const t=this.fetch().next();return!t.done&&(this.#wt.push(t.value),!0)}map(t){return this.all().map(t)}forEach(t){this.all().forEach(t)}[Symbol.iterator](){return this.fetchAll()}}const Bo=new Set(Array.from(["$and","$or","$nor","$expr","$jsonSchema"]));class $o{#mt;#C;#Ot;constructor(t,e){this.#Ot=Dr(t),this.#C=oo(e),this.#mt=[],this.compile()}compile(){br(_r(this.#Ot),`query criteria must be an object: ${JSON.stringify(this.#Ot)}`);const t={};for(const[e,n]of Object.entries(this.#Ot)){if("$where"===e)br(this.#C.scriptEnabled,"$where operator requires 'scriptEnabled' option to be true."),Object.assign(t,{field:e,expr:n});else if(Bo.has(e))this.processOperator(e,e,n);else{br(!Xr(e),`unknown top level operator: ${e}`);for(const[t,r]of Object.entries(Zr(n)))this.processOperator(e,t,r)}t.field&&this.processOperator(t.field,t.field,t.expr)}}processOperator(t,e,n){const r=ao("query",e,this.#C);br(!!r,`unknown query operator ${e}`),this.#mt.push(r(t,n,this.#C))}test(t){return this.#mt.every((e=>e(t)))}find(t,e){return new Io(t,(t=>this.test(t)),e||{},this.#C)}remove(t){return t.reduce(((t,e)=>(this.test(e)||t.push(e),t)),[])}}function Do(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Lo(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Do(Object(n),!0).forEach((function(e){c(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Do(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Ro(t){return(e,n,r)=>{const o={unwrapArray:!0},i=Math.max(1,e.split(".").length-1);return s=>{const c=zr(s,e,o);return t(c,n,Lo(Lo({},r),{},{depth:i}))}}}function Mo(t){return(e,n,r)=>{const o=uo(e,n,null,r);return t(...o)}}function Co(t,e,n){return!!Ur(t,e)||(!(!Sr(t)||!Sr(e))||!!jr(t)&&(t.some((t=>Ur(t,e)))||Mr(t,null==n?void 0:n.depth).some((t=>Ur(t,e)))))}function Uo(t,e,n){return!Co(t,e,n)}function No(t,e,n){return Sr(t)?e.some((t=>null===t)):function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:fr;const n=[gr.init(e),gr.init(e)];if(0===t.length)return[];if(t.some((t=>0===t.length)))return[];if(1===t.length)return[...t];t[t.length-1].forEach((t=>n[0].set(t,!0)));for(let e=t.length-2;e>-1;e--){if(t[e].forEach((t=>{n[0].has(t)&&n[1].set(t,!0)})),0===n[1].size)return[];n.reverse(),n[1].clear()}return Array.from(n[0].keys())}([Br(t),e],null==n?void 0:n.hashFunction).length>0}function Vo(t,e,n){return Jo(t,e,((t,e)=>yr(t,e)<0))}function Fo(t,e,n){return Jo(t,e,((t,e)=>yr(t,e)<=0))}function Ko(t,e,n){return Jo(t,e,((t,e)=>yr(t,e)>0))}function zo(t,e,n){return Jo(t,e,((t,e)=>yr(t,e)>=0))}function qo(t){return Xr(t)&&-1===["$and","$or","$nor"].indexOf(t)}function Go(t,e,n){if(jr(t)&&!Ir(t)){let r=t=>t,o=e;Object.keys(e).every(qo)&&(o={temp:e},r=t=>({temp:t}));const i=new $o(o,n);for(let e=0,n=t.length;e<n;e++)if(i.test(r(t[e])))return!0}return!1}const Wo=t=>null===t,Yo={array:jr,boolean:mr,bool:mr,date:Ar,number:Er,int:Er,long:Er,double:Er,decimal:Er,null:Wo,object:_r,regexp:xr,regex:xr,string:Or,undefined:Sr,function:t=>{throw new ar("unsupported type key `function`.")},1:Er,2:Or,3:_r,4:jr,6:Sr,8:mr,9:Ar,10:Wo,11:xr,16:Er,18:Er,19:Er};function Ho(t,e,n){const r=Yo[e];return!!r&&r(t)}function Jo(t,e,n){return Br(t).some((t=>wr(t)===wr(e)&&n(t,e)))}const Qo=Mo(Co),Xo=Mo(Ko),Zo=Mo(zo),ti=Mo(Vo),ei=Mo(Fo),ni=Mo(Uo);var ri=Object.freeze({__proto__:null,$cmp:(t,e,n)=>{const r=uo(t,e,null,n);return br(jr(r)&&2==r.length,"$cmp: expression must resolve to array of size 2."),yr(r[0],r[1])},$eq:Qo,$gt:Xo,$gte:Zo,$lt:ti,$lte:ei,$ne:ni});new Set(["monday","mon","tuesday","tue","wednesday","wed","thursday","thu","friday","fri","saturday","sat","sunday","sun"]);function oi(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function ii(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?oi(Object(n),!0).forEach((function(e){c(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):oi(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}const si=(t,e)=>{const n={};return t.split("").forEach(((t,r)=>n[t]=e*(r+1))),n};ii(ii(ii({},si("ABCDEFGHIKLM",1)),si("NOPQRSTUVWXY",-1)),{},{Z:0});const ci={undefined:null,null:null,NaN:NaN,Infinity:new Error,"-Infinity":new Error};function ai(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ci;const n=Object.assign({},ci,e),r=new Set(Object.keys(n));return(e,o,i)=>{const s=uo(e,o,null,i);if(r.has(`${s}`)){const e=n[`${s}`];if(e instanceof Error)throw new ar(`cannot apply $${t.name} to -inf, value must in (-inf,inf)`);return e}return t(s)}}ai(Math.acos,{Infinity:1/0,0:new Error}),ai(Math.acosh,{Infinity:1/0,0:new Error}),ai(Math.asin),ai(Math.asinh,{Infinity:1/0,"-Infinity":-1/0}),ai(Math.atan),ai(Math.atanh,{1:1/0,"-1":-1/0}),ai(Math.cos),ai(Math.cosh,{"-Infinity":1/0,Infinity:1/0});const ui=Math.PI/180;ai((t=>t*ui),{Infinity:1/0,"-Infinity":1/0});const li=180/Math.PI;ai((t=>t*li),{Infinity:1/0,"-Infinity":-1/0}),ai(Math.sin),ai(Math.sinh,{"-Infinity":-1/0,Infinity:1/0}),ai(Math.tan);var fi=Object.freeze({__proto__:null,$elemMatch:(t,e,n,r)=>{const o=zr(t,n),i=new $o(e,r);br(jr(o),"$elemMatch: argument must resolve to array");const s=[];for(let t=0;t<o.length;t++)if(i.test(o[t])){if(r.useStrictMode)return[o[t]];s.push(o[t])}return s.length>0?s:void 0},$slice:(t,e,n,r)=>{const o=zr(t,n),i=e;return jr(o)?((t,e,n)=>{const r=uo(t,e,null,n),o=r[0];let i=r[1],s=r[2];return Sr(s)?i<0?i=Math.max(0,o.length+i):(s=i,i=0):(i<0&&(i=Math.max(0,o.length+i)),br(s>0,"Invalid argument for $slice operator. Limit must be a positive number"),s+=i),o.slice(i,s)})(t,jr(e)?[o,...i]:[o,e],r):o}});const hi=Ro((function(t,e,n){if(!(jr(t)&&jr(e)&&t.length&&e.length))return!1;let r=!0;for(const o of e){if(!r)break;r=_r(o)&&Object.keys(o).includes("$elemMatch")?Go(t,o.$elemMatch,n):xr(o)?t.some((t=>"string"==typeof t&&o.test(t))):t.some((t=>Ur(o,t)))}return r})),pi=Ro(Go),di=Ro((function(t,e,n){return Array.isArray(t)&&t.length===e})),yi=t=>Ro(((e,n,r)=>{let o=0;if(jr(n))for(const t of n)o|=1<<t;else o=n;return t(e&o,o)})),gi=yi(((t,e)=>0==t)),bi=yi(((t,e)=>t==e)),vi=yi(((t,e)=>t<e)),wi=yi(((t,e)=>t>0)),mi=Ro(Co),Oi=Ro(Ko),Ei=Ro(zo),ji=Ro(No),_i=Ro(Vo),ki=Ro(Fo),Ai=Ro(Uo),xi=Ro((function(t,e,n){return!No(t,e,n)})),Pi=Ro((function(t,e,n){return jr(e)?e.findIndex((e=>Ho(t,e)))>=0:Ho(t,e)}));const Si=Ro((function(t,e,n){return Br(t).some((t=>2===e.length&&t%e[0]===e[1]))})),Ti=Ro((function(t,e,n){const r=Br(t),o=t=>Or(t)&&Tr(e.exec(t),null==n?void 0:n.useStrictMode);return r.some(o)||Mr(r,1).some(o)}));const Ii=(t,e,n)=>{br(jr(e),"Invalid expression. $or expects value to be an Array");const r=e.map((t=>new $o(t,n)));return t=>r.some((e=>e.test(t)))};var Bi=Object.freeze({__proto__:null,$all:hi,$and:(t,e,n)=>{br(jr(e),"Invalid expression: $and expects value to be an Array.");const r=e.map((t=>new $o(t,n)));return t=>r.every((e=>e.test(t)))},$bitsAllClear:gi,$bitsAllSet:bi,$bitsAnyClear:vi,$bitsAnySet:wi,$elemMatch:pi,$eq:mi,$exists:(t,e,n)=>{const r=t.includes("."),o=!!e;return!r||t.match(/\.\d+$/)?e=>void 0!==zr(e,t)===o:e=>{const n=zr(qr(e,t,{preserveIndex:!0}),t.substring(0,t.lastIndexOf(".")));return jr(n)?n.some((t=>void 0!==t))===o:void 0!==n===o}},$expr:function(t,e,n){return t=>uo(t,e,null,n)},$gt:Oi,$gte:Ei,$in:ji,$jsonSchema:function(t,e,n){if(null==n||!n.jsonSchemaValidator)throw new ar("Missing option 'jsonSchemaValidator'. Configure to use '$jsonSchema' operator.");const r=null==n?void 0:n.jsonSchemaValidator(e);return t=>r(t)},$lt:_i,$lte:ki,$mod:Si,$ne:Ai,$nin:xi,$nor:(t,e,n)=>{br(jr(e),"Invalid expression. $nor expects value to be an array.");const r=Ii(0,e,n);return t=>!r(t)},$not:(t,e,n)=>{const r={};r[t]=Zr(e);const o=new $o(r,n);return t=>!o.test(t)},$or:Ii,$regex:Ti,$size:di,$type:Pi,$where:function(t,e,n){br(n.scriptEnabled,"$where operator requires 'scriptEnabled' option to be true");const r=e;return br(Pr(r),"$where only accepts a Function object"),t=>Tr(r.call(t),null==n?void 0:n.useStrictMode)}});function $i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Di(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?$i(Object(n),!0).forEach((function(e){c(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}co("expression",Di(Di({},yo),ri)),co("pipeline",{$project:Eo,$skip:ko,$limit:mo,$sort:Ao}),co("projection",fi),co("query",Bi),oo({context:io.init().addQueryOps(Bi).addExpressionOps(yo).addExpressionOps(ri)});var Li=Object.prototype;function Ri(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Li)}function Mi(t,e){return function(n){return t(e(n))}}var Ci=Mi(Object.keys,Object),Ui=Object.prototype.hasOwnProperty;function Ni(t){if(!Ri(t))return Ci(t);var e=[];for(var n in Object(t))Ui.call(t,n)&&"constructor"!=n&&e.push(n);return e}var Vi="object"==typeof global&&global&&global.Object===Object&&global,Fi="object"==typeof self&&self&&self.Object===Object&&self,Ki=Vi||Fi||Function("return this")(),zi=Ki.Symbol,qi=Object.prototype,Gi=qi.hasOwnProperty,Wi=qi.toString,Yi=zi?zi.toStringTag:void 0;var Hi=Object.prototype.toString;var Ji=zi?zi.toStringTag:void 0;function Qi(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":Ji&&Ji in Object(t)?function(t){var e=Gi.call(t,Yi),n=t[Yi];try{t[Yi]=void 0;var r=!0}catch(t){}var o=Wi.call(t);return r&&(e?t[Yi]=n:delete t[Yi]),o}(t):function(t){return Hi.call(t)}(t)}function Xi(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function Zi(t){if(!Xi(t))return!1;var e=Qi(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e}var ts,es=Ki["__core-js_shared__"],ns=(ts=/[^.]+$/.exec(es&&es.keys&&es.keys.IE_PROTO||""))?"Symbol(src)_1."+ts:"";var rs=Function.prototype.toString;function os(t){if(null!=t){try{return rs.call(t)}catch(t){}try{return t+""}catch(t){}}return""}var is=/^\[object .+?Constructor\]$/,ss=Function.prototype,cs=Object.prototype,as=ss.toString,us=cs.hasOwnProperty,ls=RegExp("^"+as.call(us).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function fs(t){return!(!Xi(t)||(e=t,ns&&ns in e))&&(Zi(t)?ls:is).test(os(t));var e}function hs(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return fs(n)?n:void 0}var ps=hs(Ki,"DataView"),ds=hs(Ki,"Map"),ys=hs(Ki,"Promise"),gs=hs(Ki,"Set"),bs=hs(Ki,"WeakMap"),vs="[object Map]",ws="[object Promise]",ms="[object Set]",Os="[object WeakMap]",Es="[object DataView]",js=os(ps),_s=os(ds),ks=os(ys),As=os(gs),xs=os(bs),Ps=Qi;(ps&&Ps(new ps(new ArrayBuffer(1)))!=Es||ds&&Ps(new ds)!=vs||ys&&Ps(ys.resolve())!=ws||gs&&Ps(new gs)!=ms||bs&&Ps(new bs)!=Os)&&(Ps=function(t){var e=Qi(t),n="[object Object]"==e?t.constructor:void 0,r=n?os(n):"";if(r)switch(r){case js:return Es;case _s:return vs;case ks:return ws;case As:return ms;case xs:return Os}return e});var Ss=Ps;function Ts(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=9007199254740991}function Is(t){return null!=t&&Ts(t.length)&&!Zi(t)}var Bs=Array.isArray;function $s(t){return null!=t&&"object"==typeof t}function Ds(t){return function(e){return null==e?void 0:e[t]}}var Ls=Ds("length"),Rs=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var Ms="\\ud800-\\udfff",Cs="["+Ms+"]",Us="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Ns="\\ud83c[\\udffb-\\udfff]",Vs="[^"+Ms+"]",Fs="(?:\\ud83c[\\udde6-\\uddff]){2}",Ks="[\\ud800-\\udbff][\\udc00-\\udfff]",zs="(?:"+Us+"|"+Ns+")"+"?",qs="[\\ufe0e\\ufe0f]?",Gs=qs+zs+("(?:\\u200d(?:"+[Vs,Fs,Ks].join("|")+")"+qs+zs+")*"),Ws="(?:"+[Vs+Us+"?",Us,Fs,Ks,Cs].join("|")+")",Ys=RegExp(Ns+"(?="+Ns+")|"+Ws+Gs,"g");function Hs(t){return function(t){return Rs.test(t)}(t)?function(t){for(var e=Ys.lastIndex=0;Ys.test(t);)++e;return e}(t):Ls(t)}function Js(t){if(null==t)return 0;if(Is(t))return function(t){return"string"==typeof t||!Bs(t)&&$s(t)&&"[object String]"==Qi(t)}(t)?Hs(t):t.length;var e=Ss(t);return"[object Map]"==e||"[object Set]"==e?t.size:Ni(t).length}function Qs(t){return"symbol"==typeof t||$s(t)&&"[object Symbol]"==Qi(t)}var Xs=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Zs=/^\w*$/;function tc(t,e){if(Bs(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!Qs(t))||(Zs.test(t)||!Xs.test(t)||null!=e&&t in Object(e))}var ec=hs(Object,"create");var nc=Object.prototype.hasOwnProperty;var rc=Object.prototype.hasOwnProperty;function oc(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function ic(t,e){return t===e||t!=t&&e!=e}function sc(t,e){for(var n=t.length;n--;)if(ic(t[n][0],e))return n;return-1}oc.prototype.clear=function(){this.__data__=ec?ec(null):{},this.size=0},oc.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},oc.prototype.get=function(t){var e=this.__data__;if(ec){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return nc.call(e,t)?e[t]:void 0},oc.prototype.has=function(t){var e=this.__data__;return ec?void 0!==e[t]:rc.call(e,t)},oc.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=ec&&void 0===e?"__lodash_hash_undefined__":e,this};var cc=Array.prototype.splice;function ac(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function uc(t,e){var n=t.__data__;return function(t){var e=typeof t;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}(e)?n["string"==typeof e?"string":"hash"]:n.map}function lc(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}ac.prototype.clear=function(){this.__data__=[],this.size=0},ac.prototype.delete=function(t){var e=this.__data__,n=sc(e,t);return!(n<0)&&(n==e.length-1?e.pop():cc.call(e,n,1),--this.size,!0)},ac.prototype.get=function(t){var e=this.__data__,n=sc(e,t);return n<0?void 0:e[n][1]},ac.prototype.has=function(t){return sc(this.__data__,t)>-1},ac.prototype.set=function(t,e){var n=this.__data__,r=sc(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},lc.prototype.clear=function(){this.size=0,this.__data__={hash:new oc,map:new(ds||ac),string:new oc}},lc.prototype.delete=function(t){var e=uc(this,t).delete(t);return this.size-=e?1:0,e},lc.prototype.get=function(t){return uc(this,t).get(t)},lc.prototype.has=function(t){return uc(this,t).has(t)},lc.prototype.set=function(t,e){var n=uc(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};function fc(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var n=function(){var r=arguments,o=e?e.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var s=t.apply(this,r);return n.cache=i.set(o,s)||i,s};return n.cache=new(fc.Cache||lc),n}fc.Cache=lc;var hc,pc,dc,yc=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,gc=/\\(\\)?/g,bc=(hc=function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(yc,(function(t,n,r,o){e.push(r?o.replace(gc,"$1"):n||t)})),e},pc=fc(hc,(function(t){return 500===dc.size&&dc.clear(),t})),dc=pc.cache,pc),vc=bc;function wc(t,e){for(var n=-1,r=null==t?0:t.length,o=Array(r);++n<r;)o[n]=e(t[n],n,t);return o}var mc=zi?zi.prototype:void 0,Oc=mc?mc.toString:void 0;function Ec(t){if("string"==typeof t)return t;if(Bs(t))return wc(t,Ec)+"";if(Qs(t))return Oc?Oc.call(t):"";var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function jc(t){return null==t?"":Ec(t)}function _c(t,e){return Bs(t)?t:tc(t,e)?[t]:vc(jc(t))}function kc(t){if("string"==typeof t||Qs(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function Ac(t,e){for(var n=0,r=(e=_c(e,t)).length;null!=t&&n<r;)t=t[kc(e[n++])];return n&&n==r?t:void 0}function xc(t,e,n){var r=null==t?void 0:Ac(t,e);return void 0===r?n:r}function Pc(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}var Sc,Tc=function(t,e,n){for(var r=-1,o=Object(t),i=n(t),s=i.length;s--;){var c=i[Sc?s:++r];if(!1===e(o[c],c,o))break}return t};function Ic(t){return $s(t)&&"[object Arguments]"==Qi(t)}var Bc=Object.prototype,$c=Bc.hasOwnProperty,Dc=Bc.propertyIsEnumerable,Lc=Ic(function(){return arguments}())?Ic:function(t){return $s(t)&&$c.call(t,"callee")&&!Dc.call(t,"callee")},Rc=Lc;var Mc="object"==typeof exports&&exports&&!exports.nodeType&&exports,Cc=Mc&&"object"==typeof module&&module&&!module.nodeType&&module,Uc=Cc&&Cc.exports===Mc?Ki.Buffer:void 0,Nc=(Uc?Uc.isBuffer:void 0)||function(){return!1},Vc=/^(?:0|[1-9]\d*)$/;function Fc(t,e){var n=typeof t;return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&Vc.test(t))&&t>-1&&t%1==0&&t<e}var Kc={};function zc(t){return function(e){return t(e)}}Kc["[object Float32Array]"]=Kc["[object Float64Array]"]=Kc["[object Int8Array]"]=Kc["[object Int16Array]"]=Kc["[object Int32Array]"]=Kc["[object Uint8Array]"]=Kc["[object Uint8ClampedArray]"]=Kc["[object Uint16Array]"]=Kc["[object Uint32Array]"]=!0,Kc["[object Arguments]"]=Kc["[object Array]"]=Kc["[object ArrayBuffer]"]=Kc["[object Boolean]"]=Kc["[object DataView]"]=Kc["[object Date]"]=Kc["[object Error]"]=Kc["[object Function]"]=Kc["[object Map]"]=Kc["[object Number]"]=Kc["[object Object]"]=Kc["[object RegExp]"]=Kc["[object Set]"]=Kc["[object String]"]=Kc["[object WeakMap]"]=!1;var qc="object"==typeof exports&&exports&&!exports.nodeType&&exports,Gc=qc&&"object"==typeof module&&module&&!module.nodeType&&module,Wc=Gc&&Gc.exports===qc&&Vi.process,Yc=function(){try{var t=Gc&&Gc.require&&Gc.require("util").types;return t||Wc&&Wc.binding&&Wc.binding("util")}catch(t){}}(),Hc=Yc&&Yc.isTypedArray,Jc=Hc?zc(Hc):function(t){return $s(t)&&Ts(t.length)&&!!Kc[Qi(t)]},Qc=Jc,Xc=Object.prototype.hasOwnProperty;function Zc(t,e){var n=Bs(t),r=!n&&Rc(t),o=!n&&!r&&Nc(t),i=!n&&!r&&!o&&Qc(t),s=n||r||o||i,c=s?function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}(t.length,String):[],a=c.length;for(var u in t)!e&&!Xc.call(t,u)||s&&("length"==u||o&&("offset"==u||"parent"==u)||i&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Fc(u,a))||c.push(u);return c}function ta(t){return Is(t)?Zc(t):Ni(t)}var ea=function(t,e){return function(n,r){if(null==n)return n;if(!Is(n))return t(n,r);for(var o=n.length,i=e?o:-1,s=Object(n);(e?i--:++i<o)&&!1!==r(s[i],i,s););return n}}((function(t,e){return t&&Tc(t,e,ta)})),na=ea;function ra(t){return t}function oa(t,e){return(Bs(t)?Pc:na)(t,function(t){return"function"==typeof t?t:ra}(e))}function ia(t){var e=this.__data__=new ac(t);this.size=e.size}ia.prototype.clear=function(){this.__data__=new ac,this.size=0},ia.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},ia.prototype.get=function(t){return this.__data__.get(t)},ia.prototype.has=function(t){return this.__data__.has(t)},ia.prototype.set=function(t,e){var n=this.__data__;if(n instanceof ac){var r=n.__data__;if(!ds||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new lc(r)}return n.set(t,e),this.size=n.size,this};function sa(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new lc;++e<n;)this.add(t[e])}function ca(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}function aa(t,e){return t.has(e)}sa.prototype.add=sa.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},sa.prototype.has=function(t){return this.__data__.has(t)};function ua(t,e,n,r,o,i){var s=1&n,c=t.length,a=e.length;if(c!=a&&!(s&&a>c))return!1;var u=i.get(t),l=i.get(e);if(u&&l)return u==e&&l==t;var f=-1,h=!0,p=2&n?new sa:void 0;for(i.set(t,e),i.set(e,t);++f<c;){var d=t[f],y=e[f];if(r)var g=s?r(y,d,f,e,t,i):r(d,y,f,t,e,i);if(void 0!==g){if(g)continue;h=!1;break}if(p){if(!ca(e,(function(t,e){if(!aa(p,e)&&(d===t||o(d,t,n,r,i)))return p.push(e)}))){h=!1;break}}else if(d!==y&&!o(d,y,n,r,i)){h=!1;break}}return i.delete(t),i.delete(e),h}var la=Ki.Uint8Array;function fa(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function ha(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}var pa=zi?zi.prototype:void 0,da=pa?pa.valueOf:void 0;function ya(t,e){for(var n=-1,r=e.length,o=t.length;++n<r;)t[o+n]=e[n];return t}function ga(t,e,n){var r=e(t);return Bs(t)?r:ya(r,n(t))}function ba(){return[]}var va=Object.prototype.propertyIsEnumerable,wa=Object.getOwnPropertySymbols,ma=wa?function(t){return null==t?[]:(t=Object(t),function(t,e){for(var n=-1,r=null==t?0:t.length,o=0,i=[];++n<r;){var s=t[n];e(s,n,t)&&(i[o++]=s)}return i}(wa(t),(function(e){return va.call(t,e)})))}:ba,Oa=ma;function Ea(t){return ga(t,ta,Oa)}var ja=Object.prototype.hasOwnProperty;var _a="[object Arguments]",ka="[object Array]",Aa="[object Object]",xa=Object.prototype.hasOwnProperty;function Pa(t,e,n,r,o,i){var s=Bs(t),c=Bs(e),a=s?ka:Ss(t),u=c?ka:Ss(e),l=(a=a==_a?Aa:a)==Aa,f=(u=u==_a?Aa:u)==Aa,h=a==u;if(h&&Nc(t)){if(!Nc(e))return!1;s=!0,l=!1}if(h&&!l)return i||(i=new ia),s||Qc(t)?ua(t,e,n,r,o,i):function(t,e,n,r,o,i,s){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!i(new la(t),new la(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return ic(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var c=fa;case"[object Set]":var a=1&r;if(c||(c=ha),t.size!=e.size&&!a)return!1;var u=s.get(t);if(u)return u==e;r|=2,s.set(t,e);var l=ua(c(t),c(e),r,o,i,s);return s.delete(t),l;case"[object Symbol]":if(da)return da.call(t)==da.call(e)}return!1}(t,e,a,n,r,o,i);if(!(1&n)){var p=l&&xa.call(t,"__wrapped__"),d=f&&xa.call(e,"__wrapped__");if(p||d){var y=p?t.value():t,g=d?e.value():e;return i||(i=new ia),o(y,g,n,r,i)}}return!!h&&(i||(i=new ia),function(t,e,n,r,o,i){var s=1&n,c=Ea(t),a=c.length;if(a!=Ea(e).length&&!s)return!1;for(var u=a;u--;){var l=c[u];if(!(s?l in e:ja.call(e,l)))return!1}var f=i.get(t),h=i.get(e);if(f&&h)return f==e&&h==t;var p=!0;i.set(t,e),i.set(e,t);for(var d=s;++u<a;){var y=t[l=c[u]],g=e[l];if(r)var b=s?r(g,y,l,e,t,i):r(y,g,l,t,e,i);if(!(void 0===b?y===g||o(y,g,n,r,i):b)){p=!1;break}d||(d="constructor"==l)}if(p&&!d){var v=t.constructor,w=e.constructor;v==w||!("constructor"in t)||!("constructor"in e)||"function"==typeof v&&v instanceof v&&"function"==typeof w&&w instanceof w||(p=!1)}return i.delete(t),i.delete(e),p}(t,e,n,r,o,i))}function Sa(t,e,n,r,o){return t===e||(null==t||null==e||!$s(t)&&!$s(e)?t!=t&&e!=e:Pa(t,e,n,r,Sa,o))}function Ta(t){return t==t&&!Xi(t)}function Ia(t,e){return function(n){return null!=n&&(n[t]===e&&(void 0!==e||t in Object(n)))}}function Ba(t){var e=function(t){for(var e=ta(t),n=e.length;n--;){var r=e[n],o=t[r];e[n]=[r,o,Ta(o)]}return e}(t);return 1==e.length&&e[0][2]?Ia(e[0][0],e[0][1]):function(n){return n===t||function(t,e,n,r){var o=n.length,i=o,s=!r;if(null==t)return!i;for(t=Object(t);o--;){var c=n[o];if(s&&c[2]?c[1]!==t[c[0]]:!(c[0]in t))return!1}for(;++o<i;){var a=(c=n[o])[0],u=t[a],l=c[1];if(s&&c[2]){if(void 0===u&&!(a in t))return!1}else{var f=new ia;if(r)var h=r(u,l,a,t,e,f);if(!(void 0===h?Sa(l,u,3,r,f):h))return!1}}return!0}(n,t,e)}}function $a(t,e){return null!=t&&e in Object(t)}function Da(t,e){return null!=t&&function(t,e,n){for(var r=-1,o=(e=_c(e,t)).length,i=!1;++r<o;){var s=kc(e[r]);if(!(i=null!=t&&n(t,s)))break;t=t[s]}return i||++r!=o?i:!!(o=null==t?0:t.length)&&Ts(o)&&Fc(s,o)&&(Bs(t)||Rc(t))}(t,e,$a)}function La(t){return tc(t)?Ds(kc(t)):function(t){return function(e){return Ac(e,t)}}(t)}function Ra(t){return"function"==typeof t?t:null==t?ra:"object"==typeof t?Bs(t)?(e=t[0],n=t[1],tc(e)&&Ta(n)?Ia(kc(e),n):function(t){var r=xc(t,e);return void 0===r&&r===n?Da(t,e):Sa(n,r,3)}):Ba(t):La(t);var e,n}function Ma(t,e){var n=-1,r=Is(t)?Array(t.length):[];return na(t,(function(t,o,i){r[++n]=e(t,o,i)})),r}function Ca(t,e){return(Bs(t)?wc:Ma)(t,Ra(e))}var Ua=function(){try{var t=hs(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),Na=Ua;function Va(t,e,n){"__proto__"==e&&Na?Na(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function Fa(t,e,n){(void 0!==n&&!ic(t[e],n)||void 0===n&&!(e in t))&&Va(t,e,n)}var Ka="object"==typeof exports&&exports&&!exports.nodeType&&exports,za=Ka&&"object"==typeof module&&module&&!module.nodeType&&module,qa=za&&za.exports===Ka?Ki.Buffer:void 0,Ga=qa?qa.allocUnsafe:void 0;function Wa(t,e){if(e)return t.slice();var n=t.length,r=Ga?Ga(n):new t.constructor(n);return t.copy(r),r}function Ya(t){var e=new t.constructor(t.byteLength);return new la(e).set(new la(t)),e}function Ha(t,e){var n=e?Ya(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function Ja(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}var Qa=Object.create,Xa=function(){function t(){}return function(e){if(!Xi(e))return{};if(Qa)return Qa(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}(),Za=Xa,tu=Mi(Object.getPrototypeOf,Object);function eu(t){return"function"!=typeof t.constructor||Ri(t)?{}:Za(tu(t))}var nu=Function.prototype,ru=Object.prototype,ou=nu.toString,iu=ru.hasOwnProperty,su=ou.call(Object);function cu(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var au=Object.prototype.hasOwnProperty;function uu(t,e,n){var r=t[e];au.call(t,e)&&ic(r,n)&&(void 0!==n||e in t)||Va(t,e,n)}function lu(t,e,n,r){var o=!n;n||(n={});for(var i=-1,s=e.length;++i<s;){var c=e[i],a=r?r(n[c],t[c],c,n,t):void 0;void 0===a&&(a=t[c]),o?Va(n,c,a):uu(n,c,a)}return n}var fu=Object.prototype.hasOwnProperty;function hu(t){if(!Xi(t))return function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}(t);var e=Ri(t),n=[];for(var r in t)("constructor"!=r||!e&&fu.call(t,r))&&n.push(r);return n}function pu(t){return Is(t)?Zc(t,!0):hu(t)}function du(t,e,n,r,o,i,s){var c=cu(t,n),a=cu(e,n),u=s.get(a);if(u)Fa(t,n,u);else{var l=i?i(c,a,n+"",t,e,s):void 0,f=void 0===l;if(f){var h=Bs(a),p=!h&&Nc(a),d=!h&&!p&&Qc(a);l=a,h||p||d?Bs(c)?l=c:!function(t){return $s(t)&&Is(t)}(c)?p?(f=!1,l=Wa(a,!0)):d?(f=!1,l=Ha(a,!0)):l=[]:l=Ja(c):function(t){if(!$s(t)||"[object Object]"!=Qi(t))return!1;var e=tu(t);if(null===e)return!0;var n=iu.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&ou.call(n)==su}(a)||Rc(a)?(l=c,Rc(c)?l=function(t){return lu(t,pu(t))}(c):Xi(c)&&!Zi(c)||(l=eu(a))):f=!1}f&&(s.set(a,l),o(l,a,r,i,s),s.delete(a)),Fa(t,n,l)}}function yu(t,e,n,r,o){t!==e&&Tc(e,(function(i,s){if(o||(o=new ia),Xi(i))du(t,e,s,n,yu,r,o);else{var c=r?r(cu(t,s),i,s+"",t,e,o):void 0;void 0===c&&(c=i),Fa(t,s,c)}}),pu)}var gu=Math.max;function bu(t){return function(){return t}}var vu=Na?function(t,e){return Na(t,"toString",{configurable:!0,enumerable:!1,value:bu(e),writable:!0})}:ra,wu=vu,mu=Date.now;var Ou=function(t){var e=0,n=0;return function(){var r=mu(),o=16-(r-n);if(n=r,o>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(wu),Eu=Ou;function ju(t,e){return Eu(function(t,e,n){return e=gu(void 0===e?t.length-1:e,0),function(){for(var r=arguments,o=-1,i=gu(r.length-e,0),s=Array(i);++o<i;)s[o]=r[e+o];o=-1;for(var c=Array(e+1);++o<e;)c[o]=r[o];return c[e]=n(s),function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}(t,this,c)}}(t,e,ra),t+"")}var _u,ku=(_u=function(t,e,n){yu(t,e,n)},ju((function(t,e){var n=-1,r=e.length,o=r>1?e[r-1]:void 0,i=r>2?e[2]:void 0;for(o=_u.length>3&&"function"==typeof o?(r--,o):void 0,i&&function(t,e,n){if(!Xi(n))return!1;var r=typeof e;return!!("number"==r?Is(n)&&Fc(e,n.length):"string"==r&&e in n)&&ic(n[e],t)}(e[0],e[1],i)&&(o=r<3?void 0:o,r=1),t=Object(t);++n<r;){var s=e[n];s&&_u(t,s,n,o)}return t}))),Au=ku;var xu=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)ya(e,Oa(t)),t=tu(t);return e}:ba,Pu=xu;function Su(t){return ga(t,pu,Pu)}var Tu=Object.prototype.hasOwnProperty;var Iu=/\w*$/;var Bu=zi?zi.prototype:void 0,$u=Bu?Bu.valueOf:void 0;function Du(t,e,n){var r,o=t.constructor;switch(e){case"[object ArrayBuffer]":return Ya(t);case"[object Boolean]":case"[object Date]":return new o(+t);case"[object DataView]":return function(t,e){var n=e?Ya(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Ha(t,n);case"[object Map]":case"[object Set]":return new o;case"[object Number]":case"[object String]":return new o(t);case"[object RegExp]":return function(t){var e=new t.constructor(t.source,Iu.exec(t));return e.lastIndex=t.lastIndex,e}(t);case"[object Symbol]":return r=t,$u?Object($u.call(r)):{}}}var Lu=Yc&&Yc.isMap,Ru=Lu?zc(Lu):function(t){return $s(t)&&"[object Map]"==Ss(t)},Mu=Ru;var Cu=Yc&&Yc.isSet,Uu=Cu?zc(Cu):function(t){return $s(t)&&"[object Set]"==Ss(t)},Nu=Uu,Vu="[object Arguments]",Fu="[object Function]",Ku="[object Object]",zu={};function qu(t,e,n,r,o,i){var s,c=1&e,a=2&e,u=4&e;if(n&&(s=o?n(t,r,o,i):n(t)),void 0!==s)return s;if(!Xi(t))return t;var l=Bs(t);if(l){if(s=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&Tu.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(t),!c)return Ja(t,s)}else{var f=Ss(t),h=f==Fu||"[object GeneratorFunction]"==f;if(Nc(t))return Wa(t,c);if(f==Ku||f==Vu||h&&!o){if(s=a||h?{}:eu(t),!c)return a?function(t,e){return lu(t,Pu(t),e)}(t,function(t,e){return t&&lu(e,pu(e),t)}(s,t)):function(t,e){return lu(t,Oa(t),e)}(t,function(t,e){return t&&lu(e,ta(e),t)}(s,t))}else{if(!zu[f])return o?t:{};s=Du(t,f,c)}}i||(i=new ia);var p=i.get(t);if(p)return p;i.set(t,s),Nu(t)?t.forEach((function(r){s.add(qu(r,e,n,r,t,i))})):Mu(t)&&t.forEach((function(r,o){s.set(o,qu(r,e,n,o,t,i))}));var d=l?void 0:(u?a?Su:Ea:a?pu:ta)(t);return Pc(d||t,(function(r,o){d&&(r=t[o=r]),uu(s,o,qu(r,e,n,o,t,i))})),s}zu[Vu]=zu["[object Array]"]=zu["[object ArrayBuffer]"]=zu["[object DataView]"]=zu["[object Boolean]"]=zu["[object Date]"]=zu["[object Float32Array]"]=zu["[object Float64Array]"]=zu["[object Int8Array]"]=zu["[object Int16Array]"]=zu["[object Int32Array]"]=zu["[object Map]"]=zu["[object Number]"]=zu[Ku]=zu["[object RegExp]"]=zu["[object Set]"]=zu["[object String]"]=zu["[object Symbol]"]=zu["[object Uint8Array]"]=zu["[object Uint8ClampedArray]"]=zu["[object Uint16Array]"]=zu["[object Uint32Array]"]=!0,zu["[object Error]"]=zu[Fu]=zu["[object WeakMap]"]=!1;function Gu(t){return qu(t,5)}function Wu(t){return"[object String]"===Object.prototype.toString.call(t)}function Yu(t){return!(!Wu(t)||""===t)}function Hu(t){return"[object Array]"===Object.prototype.toString.call(t)}function Ju(t){return"[object Object]"===Object.prototype.toString.call(t)}function Qu(t){return t!=t}function Xu(t){return!!function(t){return"[object Undefined]"===Object.prototype.toString.call(t)}(t)||(!!function(t){return"[object Null]"===Object.prototype.toString.call(t)}(t)||(!!function(t){if(Ju(t)){for(let e in t)return!1;return!0}return!1}(t)||(!!function(t){return!(!Wu(t)||""!==t)}(t)||(!!function(t){return!!Hu(t)&&0===t.length}(t)||!!Qu(t)))))}function Zu(t){return!!Hu(t)&&(0!==t.length&&(1!==t.length||!Xu(t[0])))}function tl(t){if(Ju(t)){for(let e in t)return!0;return!1}return!1}function el(t){let e=!1;if(Yu(t))e=!isNaN(Number(t));else if(function(t){return"[object Number]"===Object.prototype.toString.call(t)}(t)){if(Qu(t))return!1;e=!0}return e}var nl={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}function o(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function i(t,e,r,i,s){if("function"!=typeof r)throw new TypeError("The listener must be a function");var c=new o(r,i||t,s),a=n?n+e:e;return t._events[a]?t._events[a].fn?t._events[a]=[t._events[a],c]:t._events[a].push(c):(t._events[a]=c,t._eventsCount++),t}function s(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function c(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),c.prototype.eventNames=function(){var t,r,o=[];if(0===this._eventsCount)return o;for(r in t=this._events)e.call(t,r)&&o.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},c.prototype.listeners=function(t){var e=n?n+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var o=0,i=r.length,s=new Array(i);o<i;o++)s[o]=r[o].fn;return s},c.prototype.listenerCount=function(t){var e=n?n+t:t,r=this._events[e];return r?r.fn?1:r.length:0},c.prototype.emit=function(t,e,r,o,i,s){var c=n?n+t:t;if(!this._events[c])return!1;var a,u,l=this._events[c],f=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),f){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,r),!0;case 4:return l.fn.call(l.context,e,r,o),!0;case 5:return l.fn.call(l.context,e,r,o,i),!0;case 6:return l.fn.call(l.context,e,r,o,i,s),!0}for(u=1,a=new Array(f-1);u<f;u++)a[u-1]=arguments[u];l.fn.apply(l.context,a)}else{var h,p=l.length;for(u=0;u<p;u++)switch(l[u].once&&this.removeListener(t,l[u].fn,void 0,!0),f){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,e);break;case 3:l[u].fn.call(l[u].context,e,r);break;case 4:l[u].fn.call(l[u].context,e,r,o);break;default:if(!a)for(h=1,a=new Array(f-1);h<f;h++)a[h-1]=arguments[h];l[u].fn.apply(l[u].context,a)}}return!0},c.prototype.on=function(t,e,n){return i(this,t,e,n,!1)},c.prototype.once=function(t,e,n){return i(this,t,e,n,!0)},c.prototype.removeListener=function(t,e,r,o){var i=n?n+t:t;if(!this._events[i])return this;if(!e)return s(this,i),this;var c=this._events[i];if(c.fn)c.fn!==e||o&&!c.once||r&&c.context!==r||s(this,i);else{for(var a=0,u=[],l=c.length;a<l;a++)(c[a].fn!==e||o&&!c[a].once||r&&c[a].context!==r)&&u.push(c[a]);u.length?this._events[i]=1===u.length?u[0]:u:s(this,i)}return this},c.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&s(this,e)):(this._events=new r,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=n,c.EventEmitter=c,t.exports=c}(nl);var rl=e(nl.exports);var ol=/\s/;var il=/^\s+/;function sl(t){return t?t.slice(0,function(t){for(var e=t.length;e--&&ol.test(t.charAt(e)););return e}(t)+1).replace(il,""):t}var cl=/^[-+]0x[0-9a-f]+$/i,al=/^0b[01]+$/i,ul=/^0o[0-7]+$/i,ll=parseInt;function fl(t){if("number"==typeof t)return t;if(Qs(t))return NaN;if(Xi(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=Xi(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=sl(t);var n=al.test(t);return n||ul.test(t)?ll(t.slice(2),n?2:8):cl.test(t)?NaN:+t}var hl=1/0;function pl(t){return t?(t=fl(t))===hl||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}function dl(t){var e=pl(t),n=e%1;return e==e?n?e-n:e:0}function yl(t){if(!el(t))return 0;return pl(t)}function gl(t){return!!el(t)&&function(t){return"number"==typeof t&&t==dl(t)}(t=yl(t))}var bl=Ki.isFinite,vl=Math.min;var wl=function(t){var e=Math[t];return function(t,n){if(t=fl(t),(n=null==n?0:vl(dl(n),292))&&bl(t)){var r=(jc(t)+"e").split("e");return+((r=(jc(e(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}("round"),ml=wl;function Ol(t){if(!el(t))return 0;t=yl(t);let e=ml(t);return"0"===String(e)?0:e}let El="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),jl=El.length;function _l(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,e=[];var n;t=gl(n=t)&&Ol(n)>0?Ol(t):32;for(let n=0;n<t;n++)e[n]=El[0|Math.random()*jl];return e.join("")}function kl(t,e,n){var r=null==t?0:t.length;return r?function(t,e,n){var r=-1,o=t.length;e<0&&(e=-e>o?0:o+e),(n=n>o?o:n)<0&&(n+=o),o=e>n?0:n-e>>>0,e>>>=0;for(var i=Array(o);++r<o;)i[r]=t[r+e];return i}(t,(e=n||void 0===e?1:dl(e))<0?0:e,r):[]}function Al(t){let e=Object.prototype.toString.call(t);return"[object Function]"===e||"[object AsyncFunction]"===e}function xl(t,e){let n=function(){let t,e,n=new Promise((function(){t=arguments[0],e=arguments[1]}));return n.resolve=t,n.reject=e,n}();if(!Hu(t)&&!Ju(t))return n.reject("rs is not an array or object"),n;let r=!1;if(Ju(t)){r=!0;let e=[];oa(t,((t,n)=>{e.push({k:n,v:t})})),t=e}Al(e)||(e=function(t){return t});let o=-1,i=[];return t.reduce((function(t,n){return t.then((function(t){i.push(t),o+=1;let s=o,c=n;return r&&(s=n.k,c=n.v),Al(e)?e(c,s):c}))}),Promise.resolve()).then((function(t){i.push(t),i=kl(i),n.resolve(i)})).catch((function(t){n.reject(t)})),n}return function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=xc(t,"url");Yu(e)||(e="./_db");let n=xc(t,"db");Yu(n)||(n="worm");let r=xc(t,"cl");Yu(r)||(r="test");let o=`${e}/${n}/${r}`;!("undefined"!=typeof window&&void 0!==window.document)&&import("fs").then((t=>{t.mkdirSync(o,{recursive:!0})})).catch((t=>{console.log(t)}));let i=new ir(o,{valueEncoding:"json"}),s=new rl,c=async()=>{let t=[];for await(let[,e]of i.iterator())t.push(e);return t},a=async t=>{let e=null;try{e=await i.get(t)}catch(t){}return e};async function u(t){let e=!1;if(!tl(t)&&!Zu(t))return Promise.reject("data is not an effective object or array");t=Gu(t);let n=null;try{Hu(t)||(t=[t]);let e=Js(t=Ca(t,(function(t){return Yu(t.id)||(t.id=_l()),t}))),r=0;for(let e of t){tl(await a(e.id))||(await i.put(e.id,e),r++)}n={n:e,nInserted:r,ok:1},s.emit("change","insert",t,n)}catch(t){e=!0,n=t}return e?Promise.reject(n):n}return s.select=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=!1,n=null;try{let r=await c();if(tl(t)){n=new $o(t).find(r).all()}else n=r;Hu(n)||(e=!0,n=`can not select by find[${JSON.stringify(t)}]`)}catch(t){e=!0,n=t}return e?Promise.reject(n):n},s.insert=u,s.save=async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=!1;if(!tl(t)&&!Zu(t))return Promise.reject("data is not an effective object or array");t=Gu(t);let r=xc(e,"autoInsert",!0),o=null;try{Hu(t)||(t=[t]),t=Ca(t,(function(t){return Yu(t.id)||(t.id=_l()),t})),o=await xl(t,(async t=>{let e=null,n=await a(t.id);return tl(n)&&(function(t,e){return Sa(t,e)}(t,n)||(await i.put(t.id,Au(n,t)),e={update:!0})),e=tl(e)?{n:1,nModified:1,ok:1}:{n:0,nModified:0,ok:1},r&&0===e.n&&(e=await u(t)),e})),s.emit("change","save",t,o)}catch(t){n=!0,o=t}return n?Promise.reject(o):o},s.del=async function(t){let e=!1;if(!tl(t)&&!Zu(t))return Promise.reject("data is not an effective object or array");t=Gu(t);let n=null;try{Hu(t)||(t=[t]),n=await xl(t,(async t=>{let e=null;if(Yu(xc(t,"id",""))){tl(await a(t.id))?(await i.del(t.id),e={n:1,nDeleted:1,ok:1}):e={n:1,nDeleted:0,ok:1}}else e={n:1,nDeleted:0,ok:0};return e})),s.emit("change","del",t,n)}catch(t){e=!0,n=t}return e?Promise.reject(n):n},s.delAll=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=!1,n=null;try{let e=await c(),a=Js(e),u=0;if(tl(t)){let n=new $o(t).find(e).all();if(u=Js(n),0===u);else if(a===u)for(let t of e)await i.del(t.id);else{let t={};oa(n,((e,n)=>{t[e.id]={k:n,v:e}}));for(let n of e)r=t,o=n.id,Ju(r)&&(Yu(o)||el(o))&&o in r&&await i.del(n.id)}}else{u=a;for(let t of e)await i.del(t.id)}n={n:a,nDeleted:u,ok:1},s.emit("change","delAll",null,n)}catch(t){e=!0,n=t}var r,o;return e?Promise.reject(n):n},s}}));
//# sourceMappingURL=w-orm-level.umd.js.map
